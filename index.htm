<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kejohanan Bola Sepak Premier</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&amp;family=Poppins:wght@300;400;600;700&amp;display=swap" rel="stylesheet"/>
    <style>
        /* Definisi pembolehubah CSS untuk warna dan gaya yang konsisten */
        :root {
            --primary-color: #0056b3; /* Biru gelap untuk aksen */
            --secondary-color: #f8f9fa; /* Kelabu muda untuk latar belakang */
            --text-color: #333;
            --header-bg: #007bff; /* Biru utama untuk tajuk */
            --tab-active-bg: #fff; /* Putih untuk latar belakang tab aktif */
            --tab-inactive-bg: #e9ecef; /* Kelabu muda untuk latar belakang tab tidak aktif (tidak digunakan untuk tab nav utama) */
            --border-color: #dee2e6;
            --success-color: #28a745; /* Hijau untuk kejayaan/menang */
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --qualified-bg: #d5ecdb; /* Hijau lembut yang diminta */
            --qualified-text: #155724; /* Hijau gelap */
            --upcoming-bg: #e2e3e5; /* Kelabu muda untuk perlawanan akan datang */
            --upcoming-text: #6c757d; /* Kelabu gelap */
            --nav-link-hover: #004085; /* Darker blue for nav link hover (original) */
            --nav-active-text: var(--primary-color); /* Biru gelap untuk teks tab aktif */
        }

        /* Gaya asas untuk badan dokumen */
        html, body {
            height: 100%; /* Penting untuk kedudukan sticky berfungsi relatif kepada viewport */
            min-height: 100vh; /* Memastikan ketinggian viewport penuh */
            margin: 0;
            padding: 0;
            font-family: 'Inter', 'Poppins', sans-serif; /* Menggunakan Inter sebagai fon utama */
            background-color: var(--secondary-color);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden; /* Mencegah tatalan mendatar */
        }

        /* Gaya untuk kontena utama */
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }

        /* Gaya untuk tajuk utama (header) - Menggunakan Flexbox untuk penjajaran tengah */
        header {
            background-color: var(--header-bg);
            color: #fff;
            padding: 25px 0;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            position: relative;
            border-bottom-left-radius: 15px; /* Sudut bulat */
            border-bottom-right-radius: 15px; /* Sudut bulat */

            /* PENTING: Flexbox untuk menjajarkan kandungan secara menegak dan mendatar */
            display: flex;
            align-items: center; /* Menjajarkan item secara menegak di tengah */
            justify-content: center; /* Menjajarkan kandungan utama secara mendatar di tengah */
        }

        header h1 {
            margin: 0;
            font-size: 2.8em;
            font-weight: 700;
        }

        header p {
            margin: 0;
            font-size: 1.2em;
            opacity: 0.9;
        }

        /* Gaya untuk logo di tajuk - PENTING: Logo kekal di sebelah kiri */
        .header-logo {
            position: absolute; /* Mengeluarkan elemen dari aliran normal dokumen */
            left: 20px; /* Jarak dari kiri */
            top: 50%; /* Jajarkan tengah secara menegak */
            transform: translateY(-50%); /* Laraskan untuk menjajarkan tengah dengan tepat */
            height: 80px;
            width: auto;
            border-radius: 50%; /* Logo bulat */
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* Gaya untuk maklumat pengguna di tajuk (untuk admin) */
        .header-user-info {
            position: absolute;
            right: 20px;
            top: 25px;
            font-size: 0.9em;
            display: none; /* Tersembunyi secara lalai, ditunjukkan apabila log masuk */
        }

        .header-user-info span {
            font-weight: 600;
            margin-right: 5px;
        }

        .header-user-info button {
            background: none;
            border: 1px solid rgba(255,255,255,0.7);
            color: #fff;
            padding: 5px 10px;
            border-radius: 8px; /* Sudut bulat */
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .header-user-info button:hover {
            background-color: rgba(255,255,255,0.2);
        }

        /* Gaya untuk navigasi tab - PENTING: Menu navigasi kekal di atas apabila menatal */
        nav {
            background-color: var(--header-bg); /* Nav bar background kekal biru */
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            position: sticky; /* Ini membuat menu terapung */
            top: 0; /* Ini melekatkan menu di bahagian atas skrin */
            z-index: 1000; /* Pastikan ia berada di atas elemen lain */
            width: 100%; /* Pastikan lebar penuh */
            padding: 0; /* Tiada padding pada nav, tab akan menguruskan padding sendiri */
            display: flex; /* Gunakan flex untuk menjajarkan ul di tengah */
            justify-content: center;
            align-items: center;
            border-bottom: none; /* Tiada border untuk nav itu sendiri */
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
            min-height: 60px; /* Added for a more defined bar */
            position: relative; /* For positioning mobile nav logo */
        }

        /* New: Make nav bar fixed when mobile overlay is active */
        nav.nav-fixed-on-mobile {
            position: fixed; /* Override sticky when mobile menu is open */
            top: 0;
            width: 100%;
            z-index: 998; /* Below nav-overlay (999) and hamburger (1001/1002) */
        }

        /* New: Mobile nav logo display */
        .nav-mobile-logo-display {
            display: none; /* Hidden by default */
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            height: 40px; /* Smaller size for nav */
            width: auto;
            border-radius: 50%;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            z-index: 1001; /* Above nav links, below hamburger */
        }

        nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            justify-content: center; /* Menjajarkan tab sebenar di tengah */
            flex-wrap: wrap;
            width: 100%; /* Mengisi lebar penuh nav */
        }

        nav ul li {
            position: relative;
        }

        nav ul li a {
            display: block;
            padding: 18px 25px;
            text-decoration: none;
            font-weight: 600;
            transition: background-color 0.3s ease, color 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            border-radius: 0;
            margin: 0;
            position: relative;

            /* Gaya lalai (tidak aktif): kekal biru seperti nav bar */
            background-color: var(--header-bg);
            color: #fff; /* Teks putih */
        }

        nav ul li a:hover {
            background-color: var(--nav-link-hover); /* Darker blue on hover */
            color: #fff;
        }

        nav ul li a.active {
            background-color: var(--tab-active-bg); /* Latar belakang aktif: putih */
            color: var(--nav-active-text); /* Warna teks aktif: biru gelap */
            font-weight: 700;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.1); /* Bayangan halus untuk tab aktif */
            border-bottom: none; /* Pastikan tiada border-bottom */
        }

        /* Hamburger menu icon */
        .hamburger-menu {
            display: none; /* Hidden by default on desktop */
            position: absolute; /* Default position relative to nav, so it moves with sticky nav */
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 30px;
            height: 20px;
            cursor: pointer;
            flex-direction: column;
            justify-content: space-between;
            z-index: 1002; /* Above nav links and mobile logo */
            transition: all 0.3s ease-in-out; /* Smooth transition for position changes */
            background-color: var(--header-bg); /* Contrast background */
            padding: 5px;
            border-radius: 5px;
        }

        /* When overlay is active, fix the hamburger menu position */
        .hamburger-menu.active-overlay {
            position: fixed; /* Fix position relative to viewport when mobile menu is open */
            top: 25px; /* Adjust as needed */
            right: 20px; /* Adjust as needed */
            transform: translateY(0); /* Reset transform if needed */
            z-index: 1002; /* Ensure it's above the overlay */
        }

        .hamburger-menu span {
            display: block;
            width: 100%;
            height: 3px;
            background-color: #fff;
            border-radius: 2px;
            transition: all 0.3s ease-in-out;
        }

        /* Animation for hamburger icon when active */
        .hamburger-menu.active span:nth-child(1) {
            transform: translateY(8px) rotate(45deg);
        }
        .hamburger-menu.active span:nth-child(2) {
            opacity: 0;
        }
        .hamburger-menu.active span:nth-child(3) {
            transform: translateY(-8px) rotate(-45deg);
        }

        /* Mobile nav off-canvas overlay */
        .nav-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* Darker semi-transparent overlay */
            z-index: 999;
            display: flex;
            justify-content: flex-start; /* Align menu to the left */
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .nav-overlay.active {
            visibility: visible;
            opacity: 1;
        }

        .nav-overlay ul {
            flex-direction: column;
            width: 80%; /* Slightly wider off-canvas menu */
            max-width: 320px; /* Increased max-width */
            background-color: var(--header-bg);
            height: 100%; /* Make it fill the height of the overlay */
            padding: 30px 0; /* Increased padding */
            box-shadow: 2px 0 15px rgba(0,0,0,0.7); /* Stronger shadow */
            transform: translateX(-100%); /* Start off-screen to the left */
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); /* Smoother transition */
            overflow-y: auto; /* Enable scrolling for long menus */
            justify-content: flex-start; /* Align menu items to top */
        }

        .nav-overlay.active ul {
            transform: translateX(0); /* Slide in */
        }

        .nav-overlay ul li {
            margin-bottom: 10px; /* Added vertical spacing between menu items */
            width: 100%;
        }

        .nav-overlay ul li:last-child {
            margin-bottom: 0; /* No margin for the last item */
        }

        .nav-overlay ul li a {
            /* Gaya lalai untuk item menu mudah alih */
            background-color: transparent; /* Kekal transparent pada latar belakang overlay biru */
            color: #fff; /* Teks putih */
            padding: 15px 30px;
            width: 100%;
            text-align: left;
            font-size: 1.15em;
            border-radius: 0;
            transition: background-color 0.3s ease, border-left-color 0.3s ease;
            box-sizing: border-box;
            border-left: 5px solid transparent; /* Border kiri untuk aktif */
        }

        .nav-overlay ul li a:hover {
            background-color: var(--nav-link-hover);
        }

        .nav-overlay ul li a.active {
            background-color: var(--tab-active-bg); /* Latar belakang aktif: putih untuk mobile link */
            color: var(--nav-active-text); /* Warna teks aktif: biru gelap untuk mobile link */
            border-left-color: var(--nav-active-text); /* Border kiri warna biru gelap */
        }


        /* Gaya untuk kandungan tab */
        .tab-content {
            display: none;
            padding: 30px;
            background-color: #fff;
            border-radius: 12px; /* Sudut bulat */
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-top: 20px;
            animation: fadeIn 0.5s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        /* Animasi pudar masuk */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            color: var(--header-bg);
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            font-weight: 700;
        }

        h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.8em;
            font-weight: 600;
        }

        /* Bahagian Laman Utama */
        .home-section {
            text-align: center;
        }
        .home-section img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin-bottom: 25px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .home-section p {
            font-size: 1.15em;
            max-width: 800px;
            margin: 0 auto 20px auto;
        }
        .cta-buttons button {
            background-color: var(--primary-color);
            color: #fff;
            border: none;
            padding: 12px 25px;
            font-size: 1.1em;
            border-radius: 8px; /* Sudut bulat */
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin: 0 10px;
            font-weight: 600;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .cta-buttons button:hover {
            background-color: #004085;
            transform: translateY(-3px);
        }

        /* Bahagian Pengenalan - Paparan Pasukan */
        .team-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        .team-card {
            background-color: var(--secondary-color);
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            padding: 15px;
            text-align: center;
            width: 180px;
            transition: transform 0.2s ease;
            position: relative; /* Untuk pautan info */
        }

        .team-card:hover {
            transform: translateY(-5px);
        }

        .team-card img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 50%;
            margin-bottom: 10px;
            border: 3px solid var(--primary-color);
        }

        .team-card h4 {
            margin: 0;
            font-size: 1.1em;
            color: var(--primary-color);
        }

        .team-info-link {
            display: block; /* Make it a block element */
            margin-top: 10px; /* Space below team name */
            text-align: center; /* Center align the link */
            background-color: var(--info-color);
            color: white;
            padding: 5px 8px;
            border-radius: 5px;
            font-size: 0.75em;
            text-decoration: none;
            transition: background-color 0.2s ease;
            cursor: pointer;
            width: fit-content; /* Make button width fit content */
            margin-left: auto; /* Center the button */
            margin-right: auto; /* Center the button */
        }

        .team-info-link:hover {
            background-color: #117a8b;
        }


        /* Countdown */
        .countdown-section {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background-color: #eaf3fe;
            border-radius: 10px;
            border: 1px solid #a7d3ff;
        }
        .countdown-timer {
            font-size: 3em;
            font-weight: 700;
            color: var(--header-bg);
            margin: 20px 0;
        }
        .countdown-message {
            font-size: 1.2em;
            color: var(--primary-color);
            font-weight: 600;
        }


        /* Jadual Kedudukan */
        .standings-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            background-color: #fff;
            border-radius: 10px; /* Sudut bulat */
            overflow: hidden; /* Memastikan sudut bulat */
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .standings-table th, .standings-table td {
            padding: 15px 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .standings-table th {
            background-color: var(--primary-color);
            color: #fff;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.5px;
            font-size: 0.9em;
        }

        /* Semua baris kini menggunakan warna latar yang sama */
        .standings-table tbody tr {
            background-color: #f6f9fc;
        }

        .standings-table tbody tr:hover {
            background-color: #e9f0f7;
            cursor: pointer;
        }

        .standings-table td.team-name {
            font-weight: 600;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .standings-table td.team-name img {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            object-fit: cover;
            border: 1px solid #eee;
        }

        .standings-table .qualified {
            background-color: var(--qualified-bg) !important; /* Guna !important untuk override */
            color: var(--qualified-text);
            font-weight: 700;
        }

        /* Jadual Perlawanan - Diubah untuk paparan satu demi satu */
        .match-fixtures {
            display: flex; /* Menggunakan flexbox untuk menyusun item secara menegak */
            flex-direction: column;
            gap: 20px; /* Ruang antara setiap kad perlawanan */
            margin-top: 30px;
        }

        .match-card {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            padding: 20px;
            text-align: center;
            display: flex; /* Menggunakan flexbox untuk susun atur dalaman */
            flex-direction: column; /* Menyusun elemen dalam kad secara menegak */
            align-items: center; /* Menjajarkan kandungan tengah secara mendatar */
            justify-content: space-between;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            width: 100%; /* Memastikan kad mengambil lebar penuh */
            box-sizing: border-box; /* Sertakan padding dalam lebar */
        }

        .match-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.12);
        }

        .match-card.played {
            border-left: 5px solid var(--success-color); /* Green border for played matches */
        }

        .match-card.upcoming {
            border-left: 5px solid var(--upcoming-text);
            background-color: var(--upcoming-bg);
            color: var(--upcoming-text);
        }

        .match-card .match-date-time {
            font-size: 0.9em;
            color: #777;
            margin-bottom: 15px; /* Ruang lebih di bawah tarikh/masa */
        }

        /* New: Container for team names and 'vs' on one line */
        .match-card .teams-line {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            gap: 15px; /* Space between team name blocks and 'vs' */
            flex-wrap: wrap; /* Allow wrapping on small screens */
            margin-bottom: 5px; /* Small space below this line */
        }

        .match-card .team-name-display {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.3em; /* Saiz fon lebih besar untuk nama pasukan */
            font-weight: 600;
            color: var(--primary-color);
            text-align: center; /* Memastikan teks di tengah jika ia membungkus */
            flex-shrink: 0; /* Prevent shrinking */
        }

        .match-card .team-name-display img {
            width: 30px; /* Logo sedikit lebih besar */
            height: 30px;
            border-radius: 50%;
            object-fit: cover;
        }

        .match-card .vs {
            margin: 0 10px; /* Ruang di sekeliling 'vs' */
            font-size: 1.1em; /* 'vs' lebih besar */
            font-weight: 700;
            color: #999;
            flex-shrink: 0;
        }

        /* New: Container for scores on one line */
        .match-card .scores-line {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            gap: 30px; /* Space between scores */
            margin-bottom: 10px; /* Space below scores line */
        }

        .match-card .score {
            font-size: 1.8em; /* Skor lebih besar */
            font-weight: 700;
            color: var(--header-bg);
            /* Removed margin-top as it's now in scores-line */
        }

        .match-card .winning-score {
            color: var(--success-color); /* Hijau untuk skor kemenangan */
        }

        .match-card .score-penalties {
            font-size: 0.9em;
            color: #666;
            margin-top: -5px; /* Tarik lebih dekat ke skor utama */
            margin-bottom: 10px;
            text-align: center;
            width: 100%; /* Memastikan ia merentasi lebar penuh */
        }

        .match-card.upcoming .teams-line, .match-card.upcoming .scores-line, .match-card.upcoming .score {
            color: var(--upcoming-text);
        }

        /* Kontena untuk butiran perlawanan (gol, kad) */
        .match-card .match-events-container {
            display: flex;
            justify-content: center; /* Mengagihkan ruang untuk dua lajur */
            width: 100%;
            margin-top: 15px; /* Ruang di atas acara */
            gap: 15px; /* Ruang antara lajur acara */
            /* flex-wrap: wrap; Removed for larger screens to keep them side-by-side */
        }

        .match-card .home-events-column {
            text-align: right; /* Jajarkan kandungan ke kanan */
            flex: 0 0 calc(50% - 7.5px); /* Use flex-basis to control width, accounting for gap */
            font-size: 0.8em;
            color: #555;
            padding: 10px;
            border-radius: 8px;
            background-color: #f9f9f9;
            border: 1px solid #eee;
        }

        .match-card .away-events-column {
            flex: 0 0 calc(50% - 7.5px); /* Use flex-basis to control width, accounting for gap */
            text-align: left;
            font-size: 0.8em;
            color: #555;
            padding: 10px;
            border-radius: 8px;
            background-color: #f9f9f9;
            border: 1px solid #eee;
        }

        .match-card .team-event-list div {
            margin-bottom: 2px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        /* Adjust alignment for home team events when text-align: right */
        .match-card .home-events-column .team-event-list {
            display: flex;
            flex-direction: column;
            align-items: flex-end; /* Align items to the right within the column */
        }


        /* Gaya khusus untuk ikon acara */
        .match-card .team-event-list .goal-icon { color: #28a745; font-size: 1.1em; }
        .match-card .team-event-list .yellow-card-icon { color: #ffc107; font-size: 1.1em; }
        .match-card .team-event-list .red-card-icon { color: #dc3545; font-size: 1.1em; }


        /* Admin Panel - Goal/Card Input Styling */
        .event-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            flex-wrap: wrap; /* Allow wrapping on small screens */
        }
        .event-input-group input[type="text"],
        .event-input-group input[type="number"],
        .event-input-group select { /* Added select for player dropdown */
            flex: 1; /* Distribute space */
            min-width: 80px; /* Minimum width for inputs */
            margin-bottom: 0; /* Remove default margin */
            padding: 8px; /* Smaller padding for inline inputs */
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 0.9em;
        }
        .event-input-group button {
            width: auto;
            padding: 8px 12px;
            font-size: 0.9em;
            margin-top: 0;
            flex-shrink: 0; /* Don't shrink buttons */
        }
        .event-input-group label {
            margin-bottom: 0;
            font-weight: normal;
        }

        .add-event-button {
            background-color: var(--info-color);
            margin-top: 10px;
        }
        .add-event-button:hover {
            background-color: #117a8b;
        }

        /* Highlighted score inputs */
        .score-input-highlight {
            background-color: #e6f7ff; /* Light blue background */
            border: 1px solid #91d5ff; /* Slightly darker border */
        }


        /* Carta Kalah Mati */
        .bracket-container {
            display: flex;
            justify-content: center;
            padding: 20px;
            flex-wrap: wrap;
            position: relative; /* Untuk garisan */
        }

        .bracket-round {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 40px; /* Ruang lebih antara pusingan */
            min-width: 280px;
            position: relative;
        }

        .bracket-round h3 {
            margin-bottom: 25px;
            color: var(--header-bg);
            font-size: 1.8em;
            font-weight: 700;
        }

        .bracket-match {
            background-color: #fff;
            border: 1px solid var(--border-color);
            border-radius: 10px; /* Sudut bulat */
            margin-bottom: 40px; /* Ruang lebih antara perlawanan dalam pusingan */
            padding: 18px;
            width: 250px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            text-align: center;
            position: relative;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .bracket-match:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.12);
        }

        .bracket-match .team-name {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 5px;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .bracket-match .team-name img {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            object-fit: cover;
        }

        .bracket-match .score {
            font-size: 1.4em;
            font-weight: 700;
            color: var(--header-bg);
            margin: 8px 0;
        }

        .bracket-match .date {
            font-size: 0.85em;
            color: #777;
        }

        .bracket-match .placeholder-team {
            color: #999; /* Warna kelabu untuk placeholder */
            font-style: italic;
            font-weight: 400;
        }

        /* Garisan Bracket */
        .bracket-round:first-child .bracket-match:nth-child(odd)::after {
            content: '';
            position: absolute;
            right: -40px; /* Jarak ke pusingan seterusnya */
            top: 50%;
            width: 40px;
            height: 1px;
            background-color: var(--border-color);
            transform: translateY(-50%);
        }

        .bracket-round:first-child .bracket-match:nth-child(odd)::before {
            content: '';
            position: absolute;
            right: -40px;
            top: calc(50% - 20px); /* Sambung ke perlawanan seterusnya */
            width: 1px;
            height: 40px;
            background-color: var(--border-color);
            transform: translateY(-50%);
        }

        .bracket-round:first-child .bracket-match:nth-child(even)::after {
            content: '';
            position: absolute;
            right: -40px;
            top: 50%;
            width: 40px;
            height: 1px;
            background-color: var(--border-color);
            transform: translateY(-50%);
        }

        .bracket-round:first-child .bracket-match:nth-child(even)::before {
            content: '';
            position: absolute;
            right: -40px;
            top: calc(50% + 20px);
            width: 1px;
            height: 40px;
            background-color: var(--border-color);
            transform: translateY(-50%);
        }

        /* Garisan untuk pusingan akhir */
        .bracket-round:nth-child(2) .bracket-match:first-child::before {
            content: '';
            position: absolute;
            left: -40px;
            top: 50%;
            width: 40px;
            height: 1px;
            background-color: var(--border-color);
            transform: translateY(-50%);
        }


        /* Keputusan Akhir */
        .final-result-section {
            text-align: center;
            padding: 50px 20px;
        }

        .final-result-section h2 {
            font-size: 3.5em;
            color: var(--success-color);
            margin-bottom: 40px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
        }

        .final-placement-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 40px;
        }

        .final-winner {
            background-color: var(--header-bg);
            color: #fff;
            padding: 30px;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
            animation: bounceIn 0.8s ease-out;
            width: 80%; /* Lebar yang lebih responsif */
            max-width: 450px; /* Hadkan lebar */
        }

        .final-winner .badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: #ffc107;
            color: #333;
            padding: 5px 12px;
            border-radius: 5px;
            font-weight: 700;
            font-size: 0.9em;
        }

        .final-winner img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 20px;
            border: 5px solid #fff;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .final-winner h3 {
            color: #fff;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.3);
        }

        .final-winner .placement-label {
            font-size: 1.4em;
            font-weight: 600;
            color: #f0f0f0;
        }

        .champion-place {
            background: linear-gradient(135deg, var(--header-bg) 0%, #004085 100%);
        }
        .runner-up-place {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%); /* Kelabu gelap */
        }
        .third-place-display {
            width: 100%;
            text-align: center;
            margin-top: 30px;
        }

        .third-place-display h3 {
            color: var(--primary-color);
            font-size: 1.8em;
            margin-bottom: 20px;
        }

        .third-place-cards-wrapper {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .third-place-card {
            background-color: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            width: 180px;
        }

        .third-place-card img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 10px;
            border: 2px solid var(--primary-color);
        }

        .third-place-card h4 {
            margin: 0;
            font-size: 1.2em;
            color: var(--primary-color);
        }

        /* Anugerah Individu */
        .individual-awards {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 25px;
            margin-top: 40px;
        }

        .award-card {
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            padding: 30px;
            text-align: center;
            width: 280px;
            transition: transform 0.2s ease;
        }

        .award-card:hover {
            transform: translateY(-5px);
        }

        .award-card .icon {
            font-size: 3em;
            color: var(--warning-color);
            margin-bottom: 15px;
        }

        .award-card h4 {
            color: var(--primary-color);
            font-size: 1.4em;
            margin-bottom: 10px;
        }

        .award-card p {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--header-bg);
            margin-bottom: 5px;
        }

        .award-card .school-name {
            font-size: 0.9em;
            color: #666;
            font-weight: 400;
            font-style: italic;
        }

        /* Panel Admin & Manager */
        .admin-login, .admin-content, .manager-content {
            padding: 30px;
            max-width: 700px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 12px; /* Sudut bulat */
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .admin-login h3, .admin-content h3, .admin-content h4, .manager-content h3, .manager-content h4 {
            text-align: center;
            color: var(--header-bg);
            margin-bottom: 25px;
            font-weight: 700;
        }

        .admin-login label, .admin-content label, .manager-content label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }

        .admin-login input[type="text"], .admin-login input[type="password"],
        .admin-content select, .admin-content input[type="number"], .admin-content input[type="text"],
        .admin-content input[type="date"], .admin-content input[type="time"], .admin-content input[type="url"],
        .admin-content input[type="file"],
        .manager-content input[type="text"], .manager-content input[type="password"],
        .manager-content input[type="tel"] {
            width: calc(100% - 22px); /* Mengambil kira padding */
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1em;
            box-sizing: border-box; /* Sertakan padding dalam lebar */
        }

        .admin-content textarea.players-list {
            width: calc(100% - 22px);
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1em;
            box-sizing: border-box;
            min-height: 150px;
            font-family: monospace;
        }

        .admin-login button, .admin-content button, .manager-content button {
            background-color: var(--primary-color);
            color: #fff;
            border: none;
            padding: 12px 25px;
            font-size: 1em;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            width: 100%;
            margin-top: 10px;
            font-weight: 600;
        }

        .admin-login button:hover, .admin-content button:hover, .manager-content button:hover {
            background-color: #004085;
            transform: translateY(-2px);
        }

        .admin-section-card {
            background-color: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        }

        .admin-section-card h4 {
            color: var(--primary-color);
            margin-top: 0;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .button-group button {
            flex: 1; /* Biarkan butang mengisi ruang yang tersedia */
            margin-top: 0;
        }

        .admin-content .checkbox-container {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .admin-content .checkbox-container input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
            margin-bottom: 0; /* Override default margin */
            transform: scale(1.3);
        }

        .admin-content .checkbox-container label {
            margin-bottom: 0; /* Override default margin */
            font-weight: normal;
        }


        /* Toast Notification */
        .toast-notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: #fff;
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 1em;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            min-width: 250px;
            text-align: center;
        }

        .toast-notification.show {
            opacity: 1;
            visibility: visible;
        }

        .toast-notification.success {
            background-color: var(--success-color);
        }

        .toast-notification.error {
            background-color: var(--danger-color);
        }

        .toast-notification.info {
            background-color: var(--info-color);
        }


        /* Responsive Design */
        @media (max-width: 992px) {
            header h1 {
                font-size: 2.2em;
            }
            header p {
                font-size: 1em;
            }

            /* Show mobile specific elements */
            .hamburger-menu {
                display: flex; /* Show on smaller screens */
            }
            nav ul {
                display: none; /* Hide desktop nav by default */
            }
            .nav-mobile-logo-display {
                display: block; /* Show mobile nav logo */
            }
            /* Adjust header logo and user info for mobile nav bar */
            header .header-logo {
                height: 60px;
                left: 10px;
            }
            header .header-user-info {
                top: 15px;
                right: 10px;
            }

            .bracket-round {
                margin: 0 20px;
                min-width: 250px;
            }
            .bracket-match {
                width: 220px;
                padding: 15px;
            }
            /* Adjust lines for smaller margins */
            .bracket-round:first-child .bracket-match:nth-child(odd)::after,
            .bracket-round:first-child .bracket-match:nth-child(even)::after,
            .bracket-round:nth-child(2) .bracket-match:first-child::before {
                width: 20px;
                right: -20px;
            }
            .bracket-round:first-child .bracket-match:nth-child(odd)::before,
            .bracket-round:first-child .bracket-match:nth-child(even)::before {
                right: -20px;
            }
            .bracket-round:nth-child(2) .bracket-match:first-child::before {
                left: -20px;
            }
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px auto;
                padding: 0 15px;
            }
            header {
                padding: 20px 0;
            }
            header h1 {
                font-size: 1.8em;
            }
            header p {
                font-size: 0.9em;
            }
            .home-section p {
                font-size: 1em;
            }
            .cta-buttons button {
                padding: 10px 20px;
                font-size: 1em;
                margin: 0 5px;
            }

            .team-card {
                width: 150px;
                padding: 10px;
            }
            .team-card img {
                width: 70px;
                height: 70px;
            }
            .team-card h4 {
                font-size: 1em;
            }

            .countdown-timer {
                font-size: 2.5em;
            }
            .countdown-message {
                font-size: 1.1em;
            }

            .standings-table th, .standings-table td {
                padding: 12px 8px;
                font-size: 0.85em;
            }
            .standings-table td.team-name img {
                width: 25px;
                height: 25px;
            }

            .match-card {
                padding: 15px;
            }
            .match-card .team-name-display {
                font-size: 1.1em;
            }
            .match-card .team-name-display img {
                width: 25px;
                height: 25px;
            }
            .match-card .vs {
                font-size: 1em;
                margin: 0 5px;
            }
            .match-card .score {
                font-size: 1.5em;
            }
            .match-card .match-events-container {
                flex-direction: column; /* Stack columns on smaller screens */
                gap: 10px;
            }
            .match-card .home-events-column, .match-card .away-events-column {
                width: 100%; /* Full width when stacked */
                flex: none; /* Reset flex-basis */
                text-align: left; /* Reset alignment for clarity */
            }
            .match-card .home-events-column .team-event-list {
                align-items: flex-start; /* Reset alignment for clarity */
            }


            .bracket-round {
                margin: 0 10px; /* Kurangkan margin antara pusingan */
                min-width: unset;
                width: 100%;
                margin-bottom: 20px; /* Tambah margin bawah untuk pusingan */
            }
            .bracket-match {
                width: 90%; /* Lebar kad perlawanan penuh */
                max-width: 300px;
                margin-bottom: 20px; /* Kurangkan ruang antara perlawanan */
            }
            .bracket-container {
                flex-direction: column; /* Susun pusingan secara menegak */
                align-items: center;
                padding: 10px;
            }
            /* Sembunyikan semua garisan pada paparan mudah alih */
            .bracket-match::after, .bracket-match::before,
            .bracket-round:first-child .bracket-match:nth-child(odd)::after,
            .bracket-round:first-child .bracket-match:nth-child(odd)::before,
            .bracket-round:first-child .bracket-match:nth-child(even)::after,
            .bracket-round:first-child .bracket-match:nth-child(even)::before,
            .bracket-round:nth-child(2) .bracket-match:first-child::before {
                display: none !important;
            }

            .final-result-section h2 {
                font-size: 2.5em;
            }
            .final-winner {
                padding: 20px;
            }
            .final-winner img {
                width: 100px;
                height: 100px;
            }
            .final-winner h3 {
                font-size: 2em;
            }
            .final-winner .placement-label {
                font-size: 1.2em;
            }

            .third-place-card {
                width: 150px;
            }
            .third-place-card img {
                width: 70px;
                height: 70px;
            }
            .third-place-card h4 {
                font-size: 1.1em;
            }

            .award-card {
                width: 90%;
                max-width: 300px;
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            header h1 {
                font-size: 1.5em;
            }
            header p {
                font-size: 0.8em;
            }
            .cta-buttons button {
                width: 100%;
                margin-bottom: 10px;
            }
            .admin-login, .admin-content, .manager-content {
                padding: 20px;
            }
            .admin-section-card {
                padding: 20px;
            }
            .button-group {
                flex-direction: column;
            }
            .button-group button {
                width: 100%;
            }
            .event-input-group {
                flex-direction: column;
                gap: 5px;
            }
            .event-input-group input, .event-input-group select, .event-input-group button {
                width: 100%;
                margin-bottom: 5px;
            }
            .event-input-group button {
                margin-top: 0;
            }
        }
    </style>
</head>
<body>
    <header>
        <img id="header-logo" src="https://placehold.co/100x100/cccccc/000000?text=LOGO" alt="Logo Kejohanan" class="header-logo"/>
        <div>
            <h1>Kejohanan Bola Sepak Premier</h1>
            <p>Musim 2024</p>
        </div>
        <div class="header-user-info" id="header-user-info">
            Selamat Datang, <span id="logged-in-username"></span>!
            <button id="logoutBtn">Log Keluar</button>
        </div>
    </header>

    <nav>
        <img id="nav-mobile-logo-display" src="https://placehold.co/100x100/cccccc/000000?text=LOGO" alt="Logo Nav" class="nav-mobile-logo-display"/>
        <div class="hamburger-menu" id="hamburger-menu">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="nav-overlay" id="nav-overlay">
            <ul>
                <li><a href="#home" class="nav-link active" data-tab="home">Laman Utama</a></li>
                <li><a href="#standings" class="nav-link" data-tab="standings">Kedudukan Kumpulan</a></li>
                <li><a href="#fixtures" class="nav-link" data-tab="fixtures">Jadual Perlawanan</a></li>
                <li><a href="#knockout" class="nav-link" data-tab="knockout">Peringkat Kalah Mati</a></li>
                <li><a href="#finalResult" class="nav-link" data-tab="finalResult">Keputusan Akhir & Anugerah</a></li>
                <li><a href="#admin" class="nav-link" data-tab="admin">Admin / Pengurus</a></li>
                <li id="mobile-logout-link" style="display: none;"><a href="#" class="nav-link" onclick="logout()">Log Keluar</a></li>
            </ul>
        </div>
        <ul>
            <li><a href="#home" class="nav-link active" data-tab="home">Laman Utama</a></li>
            <li><a href="#standings" class="nav-link" data-tab="standings">Kedudukan Kumpulan</a></li>
            <li><a href="#fixtures" class="nav-link" data-tab="fixtures">Jadual Perlawanan</a></li>
            <li><a href="#knockout" class="nav-link" data-tab="knockout">Peringkat Kalah Mati</a></li>
            <li><a href="#finalResult" class="nav-link" data-tab="finalResult">Keputusan Akhir & Anugerah</a></li>
            <li><a href="#admin" class="nav-link" data-tab="admin">Admin / Pengurus</a></li>
        </ul>
    </nav>

    <div class="container">
        <div id="home" class="tab-content active">
            <section class="home-section">
                <h2>Selamat Datang ke Kejohanan Bola Sepak Premier!</h2>
                <img src="https://placehold.co/800x450/eeeeee/333333?text=PADANG+BOLA+SEPAK" alt="Padang Bola Sepak"/>
                <p>Ikuti perkembangan terkini kejohanan bola sepak paling berprestij. Dapatkan maklumat tentang kedudukan pasukan, jadual perlawanan, keputusan, carta kalah mati, dan anugerah individu. Bersedia untuk aksi dan drama di padang!</p>
                <div class="cta-buttons">
                    <button onclick="changeTab('fixtures')">Lihat Jadual Perlawanan</button>
                    <button onclick="changeTab('standings')">Lihat Kedudukan</button>
                </div>
            </section>

            <section class="countdown-section" id="countdown-section" style="display: none;">
                <h3 id="countdown-message">Kira Detik Sehingga Pembahagian Kumpulan</h3>
                <div class="countdown-timer" id="countdown-timer">00:00:00</div>
            </section>

            <section class="about-section" style="margin-top: 50px;">
                <h3>Pasukan Bertanding</h3>
                <div class="team-list" id="participating-team-list">
                    <p style="text-align: center; width: 100%; color: #777;">Tiada pasukan ditambahkan lagi.</p>
                </div>
            </section>
        </div>

        <div id="standings" class="tab-content">
            <div style="text-align: right; margin-bottom: 20px;">
                <button onclick="printTab('standings')" class="print-button" style="background-color: var(--primary-color); color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer;">Cetak Kedudukan</button>
            </div>
            <h2>Kedudukan Kumpulan</h2>

            <h3>Kumpulan A</h3>
            <table class="standings-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Pasukan</th>
                        <th>P</th>
                        <th>M</th>
                        <th>S</th>
                        <th>K</th>
                        <th>J</th>
                        <th>B</th>
                        <th>&plusmn;</th>
                        <th>Mata</th>
                    </tr>
                </thead>
                <tbody id="groupA-standings-body">
                    </tbody>
            </table>

            <h3>Kumpulan B</h3>
            <table class="standings-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Pasukan</th>
                        <th>P</th>
                        <th>M</th>
                        <th>S</th>
                        <th>K</th>
                        <th>J</th>
                        <th>B</th>
                        <th>&plusmn;</th>
                        <th>Mata</th>
                    </tr>
                </thead>
                <tbody id="groupB-standings-body">
                    </tbody>
            </table>
        </div>

        <div id="fixtures" class="tab-content">
            <div style="text-align: right; margin-bottom: 20px;">
                <button onclick="printTab('fixtures')" class="print-button" style="background-color: var(--primary-color); color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer;">Cetak Jadual Perlawanan</button>
            </div>
            <h2>Jadual Perlawanan</h2>

            <h3>Perlawanan Kumpulan A</h3>
            <div class="match-fixtures" id="groupA-fixtures">
                <p style="text-align: center; width: 100%; color: #777;">Jadual kumpulan A belum dijana.</p>
            </div>

            <h3>Perlawanan Kumpulan B</h3>
            <div class="match-fixtures" id="groupB-fixtures">
                <p style="text-align: center; width: 100%; color: #777;">Jadual kumpulan B belum dijana.</p>
            </div>
        </div>

        <div id="knockout" class="tab-content">
            <div style="text-align: right; margin-bottom: 20px;">
                <button onclick="printTab('knockout')" class="print-button" style="background-color: var(--primary-color); color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer;">Cetak Carta Kalah Mati</button>
            </div>
            <h2>Carta Kalah Mati</h2>
            <div class="bracket-container" id="knockout-bracket">
                <p style="text-align: center; color: #777; font-style: italic; margin-top: 50px;">Carta Kalah Mati akan dipaparkan setelah semua perlawanan peringkat kumpulan selesai dimasukkan skor.</p>
            </div>
        </div>

        <div id="finalResult" class="tab-content">
            <div style="text-align: right; margin-bottom: 20px;">
                <button onclick="printTab('finalResult')" class="print-button" style="background-color: var(--primary-color); color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer;">Cetak Keputusan Akhir</button>
            </div>
            <section class="final-result-section">
                <h2>Keputusan Akhir Kejohanan</h2>
                <div class="final-placement-container">
                    <div class="final-winner champion-place">
                        <span class="badge">JUARA!</span>
                        <img id="final-winner-logo" src="https://placehold.co/100x100/cccccc/000000?text=LOGO" alt="Juara Logo"/>
                        <h3 id="final-winner-team">Belum Ditentukan</h3>
                        <p class="placement-label">Juara</p>
                    </div>
                    <div class="final-winner runner-up-place">
                        <img id="final-runner-up-logo" src="https://placehold.co/100x100/cccccc/000000?text=LOGO" alt="Naib Juara Logo"/>
                        <h3 id="final-runner-up-team">Belum Ditentukan</h3>
                        <p class="placement-label">Naib Juara</p>
                    </div>
                    <div class="third-place-display">
                        <h3>Tempat Ketiga Bersama</h3>
                        <div id="third-place-teams-container" class="third-place-cards-wrapper">
                            <p style="text-align: center; width: 100%; color: #777;">Belum Ditentukan</p>
                        </div>
                    </div>
                </div>

                <h3>Anugerah Individu</h3>
                <div class="individual-awards">
                    <div class="award-card">
                        <span class="icon"></span>
                        <h4>Pemain Terbaik</h4>
                        <p id="best-player-name">Belum Ditentukan</p>
                        <p class="school-name" id="best-player-school">Belum Ditentukan</p>
                    </div>
                    <div class="award-card">
                        <span class="icon"></span>
                        <h4>Penjaga Gol Terbaik</h4>
                        <p id="best-goalkeeper-name">Belum Ditentukan</p>
                        <p class="school-name" id="best-goalkeeper-school">Belum Ditentukan</p>
                    </div>
                    <div class="award-card">
                        <span class="icon"></span>
                        <h4>Penjaring Terbanyak</h4>
                        <p id="top-scorer-name">Belum Ditentukan</p>
                        <p class="school-name" id="top-scorer-school">Belum Ditentukan</p>
                    </div>
                </div>
            </section>
        </div>

        <div id="admin" class="tab-content">
            <div class="admin-login" id="login-section">
                <h3>Log Masuk</h3>
                <label for="user-role">Log Masuk Sebagai:</label>
                <select id="user-role" style="width: calc(100% - 22px); padding: 12px; margin-bottom: 20px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 1em; box-sizing: border-box;">
                    <option value="admin">Admin</option>
                    <option value="manager">Pengurus Pasukan</option>
                </select>

                <div id="admin-login-fields">
                    <label for="admin-username">Nama Pengguna Admin:</label>
                    <input type="text" id="admin-username" name="admin-username" value="admin"/>
                    <label for="admin-password">Kata Laluan Admin:</label>
                    <input type="password" id="admin-password" name="admin-password" value="1234"/>
                </div>

                <div id="manager-login-fields" style="display: none;">
                    <label for="manager-team-select">Pilih Pasukan Anda:</label>
                    <select id="manager-team-select" style="width: calc(100% - 22px); padding: 12px; margin-bottom: 20px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 1em; box-sizing: border-box;">
                        <option value="">-- Pilih Pasukan --</option>
                    </select>
                    <label for="manager-username">Nama Pengguna Pengurus:</label>
                    <input type="text" id="manager-username" name="manager-username" placeholder="Nama Pengguna Pengurus"/>
                    <label for="manager-password">Kata Laluan Pengurus:</label>
                    <input type="password" id="manager-password" name="manager-password" placeholder="Kata Laluan Pengurus"/>
                </div>
                <button id="loginBtn">Log Masuk</button>
                <p id="login-error" style="display: none; color: var(--danger-color); text-align: center; margin-top: 15px;">Nama pengguna atau kata laluan salah.</p>
            </div>

            <div class="admin-content" id="admin-content" style="display: none;">
                <h3>Panel Kawalan Admin</h3>

                <div class="admin-section-card">
                    <h4>Kemas Kini Keputusan Perlawanan</h4>
                    <label for="match-select">Pilih Perlawanan:</label>
                    <select id="match-select" onchange="displayMatchPreview()">
                        <option value="">-- Pilih Perlawanan --</option>
                    </select>
                    <div class="match-preview" id="match-preview" style="display: none;"></div>

                    <h5 style="margin-top: 20px; color: var(--primary-color);">Jaringan Pasukan Rumah:</h5>
                    <input type="number" id="score-home" min="0" value="0" oninput="autoGenerateEventInputs('home', 'goal')" class="score-input-highlight"/>
                    <div id="home-goals-input-container">
                    </div>

                    <h5 style="margin-top: 20px; color: var(--primary-color);">Kad Kuning Pasukan Rumah:</h5>
                    <input type="number" id="home-yellow-cards-count" min="0" value="0" oninput="autoGenerateEventInputs('home', 'yellow')"/>
                    <div id="home-yellow-cards-input-container">
                    </div>

                    <h5 style="margin-top: 20px; color: var(--primary-color);">Kad Merah Pasukan Rumah:</h5>
                    <input type="number" id="home-red-cards-count" min="0" value="0" oninput="autoGenerateEventInputs('home', 'red')"/>
                    <div id="home-red-cards-input-container">
                    </div>

                    <h5 style="margin-top: 20px; color: var(--primary-color);">Jaringan Pasukan Pelawat:</h5>
                    <input type="number" id="score-away" min="0" value="0" oninput="autoGenerateEventInputs('away', 'goal')" class="score-input-highlight"/>
                    <div id="away-goals-input-container">
                    </div>

                    <h5 style="margin-top: 20px; color: var(--primary-color);">Kad Kuning Pasukan Pelawat:</h5>
                    <input type="number" id="away-yellow-cards-count" min="0" value="0" oninput="autoGenerateEventInputs('away', 'yellow')"/>
                    <div id="away-yellow-cards-input-container">
                    </div>

                    <h5 style="margin-top: 20px; color: var(--primary-color);">Kad Merah Pasukan Pelawat:</h5>
                    <input type="number" id="away-red-cards-count" min="0" value="0" oninput="autoGenerateEventInputs('away', 'red')"/>
                    <div id="away-red-cards-input-container">
                    </div>

                    <div id="penalty-inputs" style="display: none;">
                        <label for="penalty-home">Jaringan Penalti Pasukan Rumah:</label>
                        <input type="number" id="penalty-home" min="0" value="0"/>
                        <label for="penalty-away">Jaringan Penalti Pasukan Pelawat:</label>
                        <input type="number" id="penalty-away" min="0" value="0"/>
                    </div>

                    <button id="updateMatchResultBtn">Kemaskini Keputusan</button>
                </div>

                <div class="admin-section-card">
                    <h4>Jana Jadual Perlawanan Kumpulan &amp; Pembahagian Automatik</h4>
                    <label for="group-match-date">Tarikh Hari Pertama Kejohanan:</label>
                    <input type="date" id="group-match-date"/>
                    <label for="group-match-time">Masa Perlawanan Pertama Bermula:</label>
                    <input type="time" id="group-match-time"/>

                    <label for="countdown-start-date">Tarikh Kira Detik Bermula:</label>
                    <input type="date" id="countdown-start-date"/>
                    <label for="countdown-start-time">Masa Kira Detik Bermula:</label>
                    <input type="time" id="countdown-start-time"/>
                    <label for="countdown-duration-input">Tempoh Kira Detik Pembahagian (saat):</label>
                    <input type="number" id="countdown-duration-input" min="5" value="10"/>
                    <button id="startGroupDivisionAndGenerateFixturesBtn">Mula Kira Detik &amp; Jana Jadual Kumpulan</button>
                    <p style="font-size: 0.9em; color: #666; margin-top: 10px;">*Ini akan memulakan kira detik. Setelah selesai, pasukan akan dibahagikan secara rawak dan jadual perlawanan kumpulan akan dijana secara automatik.</p>
                </div>

                <div class="admin-section-card">
                    <h4>Jana/Urus Jadual Perlawanan Kalah Mati</h4>
                    <div class="checkbox-container">
                        <input type="checkbox" id="enable-extra-time"/>
                        <label for="enable-extra-time">Benarkan Masa Tambahan (Nota: Admin perlu mengemas kini skor penalti secara manual jika seri selepas masa tambahan)</label>
                    </div>

                    <label for="knockout-start-date">Tarikh Mula Perlawanan Kalah Mati:</label>
                    <input type="date" id="knockout-start-date"/>
                    <label for="knockout-start-time">Masa Mula Perlawanan Kalah Mati:</label>
                    <input type="time" id="knockout-start-time"/>
                    <button id="updateKnockoutFixtureDatesBtn">Kemaskini Tarikh/Masa Kalah Mati</button>
                    <p style="font-size: 0.9em; color: #666; margin-top: 10px;">*Ini akan mengemas kini tarikh dan masa untuk semua perlawanan kalah mati.</p>

                    <label for="edit-knockout-match-select">Pilih Perlawanan Kalah Mati (untuk edit individu):</label>
                    <select id="edit-knockout-match-select" onchange="loadKnockoutMatchDetailsForEdit()">
                        <option value="">-- Pilih Perlawanan --</option>
                    </select>
                    <div id="edit-knockout-match-details" style="display: none; margin-top: 15px; padding: 15px; background-color: #eaf3fe; border-radius: 8px;">
                        <label for="edit-knockout-date">Tarikh:</label>
                        <input type="date" id="edit-knockout-date"/>
                        <label for="edit-knockout-time">Masa:</label>
                        <input type="time" id="edit-knockout-time"/>
                        <button id="saveKnockoutMatchDetailsBtn" style="margin-top: 15px;">Simpan Perubahan Kalah Mati</button>
                    </div>

                    <button id="resetKnockoutBracketBtn" style="background-color: var(--warning-color);">Set Semula Carta Kalah Mati</button>
                    <p style="font-size: 0.9em; color: #666; margin-top: 10px;">*Ini akan menetapkan semula pasukan dalam carta kalah mati kepada placeholder.</p>
                </div>

                <div class="admin-section-card">
                    <h4>Ubah Nama Pasukan &amp; Logo</h4>
                    <label for="rename-team-select">Pilih Pasukan:</label>
                    <select id="rename-team-select">
                        <option value="">-- Pilih Pasukan --</option>
                    </select>
                    <label for="new-team-name">Nama Pasukan Baharu:</label>
                    <input type="text" id="new-team-name" placeholder="Masukkan nama baharu pasukan"/>
                    <label for="new-team-logo-file">Muat Naik Logo Baharu:</label>
                    <input type="file" id="new-team-logo-file" accept="image/*"/>
                    <p style="font-size: 0.8em; color: #666; margin-top: -15px; margin-bottom: 20px;">*Sila ambil perhatian: Logo akan disimpan sebagai data dalam pelayar anda dan mungkin terhad saiznya.</p>
                    <button id="renameTeamBtn">Ubah Nama Pasukan &amp; Logo</button>
                </div>

                <div class="admin-section-card">
                    <h4>Tambah / Buang Pasukan</h4>
                    <label for="add-team-name">Nama Pasukan Baharu:</label>
                    <input type="text" id="add-team-name" placeholder="Cth: Harimau Selatan"/>
                    <label for="add-team-logo-file">Muat Naik Logo Pasukan:</label>
                    <input type="file" id="add-team-logo-file" accept="image/*"/>
                    <p style="font-size: 0.8em; color: #666; margin-top: -15px; margin-bottom: 20px;">*Sila ambil perhatian: Logo akan disimpan sebagai data dalam pelayar anda dan mungkin terhad saiznya.</p>
                    <div class="button-group">
                        <button id="addTeamBtn">Tambah Pasukan</button>
                        <button id="removeTeamBtn" style="background-color: var(--danger-color);">Buang Pasukan</button>
                    </div>

                    <h5 style="margin-top: 30px; color: var(--primary-color);">Maklumat Pengurus Pasukan Baharu (Pilihan):</h5>
                    <label for="new-team-manager-username">Nama Pengguna Pengurus:</label>
                    <input type="text" id="new-team-manager-username" placeholder="cth: pengurus_harimau"/>
                    <label for="new-team-manager-password">Kata Laluan Pengurus:</label>
                    <input type="password" id="new-team-manager-password" placeholder="kata laluan"/>
                </div>

                <div class="admin-section-card">
                    <h4>Kemas Kini Anugerah Individu</h4>
                    <label for="best-player-input">Pemain Terbaik:</label>
                    <input type="text" id="best-player-input" placeholder="Nama Pemain Terbaik"/>
                    <label for="best-player-school-input">Sekolah/Pasukan Pemain Terbaik:</label>
                    <input type="text" id="best-player-school-input" placeholder="Sekolah/Pasukan"/>

                    <label for="best-goalkeeper-input">Penjaga Gol Terbaik:</label>
                    <input type="text" id="best-goalkeeper-input" placeholder="Nama Penjaga Gol Terbaik"/>
                    <label for="best-goalkeeper-school-input">Sekolah/Pasukan Penjaga Gol Terbaik:</label>
                    <input type="text" id="best-goalkeeper-school-input" placeholder="Sekolah/Pasukan"/>

                    <label for="top-scorer-input">Penjaring Terbanyak:</label>
                    <input type="text" id="top-scorer-input" placeholder="Nama Penjaring Terbanyak"/>
                    <label for="top-scorer-school-input">Sekolah/Pasukan Penjaring Terbanyak:</label>
                    <input type="text" id="top-scorer-school-input" placeholder="Sekolah/Pasukan"/>

                    <button id="updateIndividualAwardsBtn">Kemaskini Anugerah Individu</button>
                </div>

                <div class="admin-section-card">
                    <h4>Ubah Logo Header</h4>
                    <label for="header-logo-file">Muat Naik Logo Header Baharu:</label>
                    <input type="file" id="header-logo-file" accept="image/*"/>
                    <p style="font-size: 0.8em; color: #666; margin-top: -15px; margin-bottom: 20px;">*Logo header akan dipaparkan di bahagian atas halaman.</p>
                    <button id="updateHeaderLogoBtn">Kemaskini Logo Header</button>
                </div>

                <button onclick="resetTournamentData()" style="background-color: var(--danger-color);">Set Semula Semua Data Kejohanan</button>
                <p style="font-size: 0.9em; color: #666; text-align: center; margin-top: 10px;">*Tindakan ini tidak boleh dibatalkan. Semua data kejohanan akan dipadamkan.</p>
            </div>

            <div class="manager-content" id="manager-content" style="display: none;">
                <h3>Panel Pengurus Pasukan</h3>
                <div class="admin-section-card">
                    <h4 id="manager-team-name-display">Pasukan Anda: Belum Dipilih</h4>
                    <label for="manager-name">Nama Pengurus:</label>
                    <input type="text" id="manager-name" placeholder="Nama Penuh Anda"/>
                    <label for="manager-phone">Nombor Telefon:</label>
                    <input type="tel" id="manager-phone" placeholder="Cth: 0123456789"/>
                    <button id="saveTeamInfoBtn">Simpan Maklumat Pasukan</button>
                </div>

                <div class="admin-section-card">
                    <h4>Senarai Pemain</h4>
                    <p style="font-size: 0.9em; color: #666; margin-bottom: 15px;">Masukkan setiap pemain pada baris baru dalam format: `Nama Pemain, Nombor Jersi` (cth: "Ali Bin Abu, 7")</p>
                    <textarea id="players-list-textarea" class="players-list" placeholder="Contoh:&#10;Muhammad Ali, 1&#10;Abu Bakar, 2&#10;..."></textarea>
                    <button id="savePlayersBtn">Simpan Senarai Pemain</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toast-notification" class="toast-notification">
        Ini adalah mesej toast.
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        // TODO: Gantikan dengan konfigurasi Firebase anda sendiri
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyDwjpVTE1kA1G8U2tV8YqXFAJ95pWTDUJo",
            authDomain: "skkepawa6019.firebaseapp.com",
            projectId: "skkepawa6019",
            storageBucket: "skkepawa6019.firebasestorage.app",
            messagingSenderId: "673964541816",
            appId: "1:673964541816:web:ff0d0247310cd1bb25aa8d",
            measurementId: "G-LZQ6DTWWHR"
        };
        
        // Inisialisasi Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const tournamentDataRef = db.collection('tournament').doc('current'); // Koleksi 'tournament', dokumen 'current'

        // Data kejohanan global - akan dimuat dari Firestore
        let tournamentData = {
            allParticipatingTeams: [],
            teams: { 'A': [], 'B': [] }, // Standings by group
            matches: [],
            countdownStartTime: null,
            countdownEndTime: null,
            groupDivisionDone: false,
            knockoutBracketGenerated: false,
            enableExtraTime: false,
            headerLogo: 'https://placehold.co/100x100/cccccc/000000?text=LOGO',
            lastUpdatedMatch: null,
            finalWinner: null,
            finalRunnerUp: null,
            thirdPlaceTeams: [],
            bestPlayer: null,
            bestPlayerSchool: null,
            bestGoalkeeper: null,
            bestGoalkeeperSchool: null,
            topScorer: null,
            topScorerSchool: null,
            adminCredentials: { username: 'admin', password: '123' }, // For initial setup, consider Firebase Auth later
            managerCredentials: {} // Stores manager usernames/passwords mapped to team names
        };

        let currentUser = null; // Stores { role: 'admin' | 'manager', teamName: '...' (if manager) }
        let countdownInterval;

        // =====================================================================================================
        // FIREBASE INTEGRATION FUNCTIONS
        // =====================================================================================================

        /**
         * Memuatkan data kejohanan dari Firestore.
         */
        async function loadTournamentData() {
            try {
                const doc = await tournamentDataRef.get();
                if (doc.exists) {
                    const fetchedData = doc.data();
                    // Merge fetched data with default to ensure all properties exist
                    tournamentData = { ...tournamentData, ...fetchedData };

                    // Convert any string-based date/time back to Date objects if needed
                    // (Firestore stores Date objects, but if you saved strings, convert them)
                    if (typeof tournamentData.countdownStartTime === 'string') {
                        tournamentData.countdownStartTime = new Date(tournamentData.countdownStartTime);
                    }
                    if (typeof tournamentData.countdownEndTime === 'string') {
                        tournamentData.countdownEndTime = new Date(tournamentData.countdownEndTime);
                    }
                    if (tournamentData.matches) {
                        tournamentData.matches = tournamentData.matches.map(match => {
                            if (typeof match.date === 'string') match.date = new Date(match.date); // If date is stored as string
                            return match;
                        });
                    }

                    console.log("Data kejohanan berjaya dimuat dari Firestore:", tournamentData);
                } else {
                    console.log("Tiada data kejohanan ditemui dalam Firestore. Memuatkan data lalai.");
                    // Save default data to Firestore if no data exists
                    await saveTournamentData();
                }
            } catch (error) {
                console.error("Ralat memuatkan data kejohanan dari Firestore:", error);
                showToast('Ralat memuatkan data kejohanan.', 'error');
            }
        }

        /**
         * Menyimpan data kejohanan ke Firestore.
         */
        async function saveTournamentData() {
            try {
                // Prepare data for Firestore - ensure Date objects are handled correctly
                // Firestore can handle Date objects natively, but if you have custom date string formats,
                // you might need to convert them before saving if not already Date objects.
                const dataToSave = { ...tournamentData };

                // Ensure no undefined values are saved, as Firestore doesn't allow them
                Object.keys(dataToSave).forEach(key => {
                    if (dataToSave[key] === undefined) {
                        delete dataToSave[key];
                    }
                });

                await tournamentDataRef.set(dataToSave); // Overwrite or create document
                console.log("Data kejohanan berjaya disimpan ke Firestore.");
                // showToast('Data kejohanan berjaya disimpan.', 'success'); // Only show for user-triggered saves
            } catch (error) {
                console.error("Ralat menyimpan data kejohanan ke Firestore:", error);
                showToast('Ralat menyimpan data kejohanan.', 'error');
            }
        }

        /**
         * Menetapkan semula semua data kejohanan dalam Firestore.
         */
        async function resetTournamentData() {
            if (!confirm('Adakah anda pasti mahu menetapkan semula SEMUA data kejohanan? Tindakan ini tidak boleh dibatalkan.')) {
                return;
            }

            try {
                await tournamentDataRef.set({
                    allParticipatingTeams: [],
                    teams: { 'A': [], 'B': [] },
                    matches: [],
                    countdownStartTime: null,
                    countdownEndTime: null,
                    groupDivisionDone: false,
                    knockoutBracketGenerated: false,
                    enableExtraTime: false,
                    headerLogo: 'https://placehold.co/100x100/cccccc/000000?text=LOGO',
                    lastUpdatedMatch: null,
                    finalWinner: null,
                    finalRunnerUp: null,
                    thirdPlaceTeams: [],
                    bestPlayer: null,
                    bestPlayerSchool: null,
                    bestGoalkeeper: null,
                    bestGoalkeeperSchool: null,
                    topScorer: null,
                    topScorerSchool: null,
                    adminCredentials: { username: 'admin', password: '123' }, // Reset admin credentials
                    managerCredentials: {} // Reset manager credentials
                });
                tournamentData = {
                    allParticipatingTeams: [],
                    teams: { 'A': [], 'B': [] },
                    matches: [],
                    countdownStartTime: null,
                    countdownEndTime: null,
                    groupDivisionDone: false,
                    knockoutBracketGenerated: false,
                    enableExtraTime: false,
                    headerLogo: 'https://placehold.co/100x100/cccccc/000000?text=LOGO',
                    lastUpdatedMatch: null,
                    finalWinner: null,
                    finalRunnerUp: null,
                    thirdPlaceTeams: [],
                    bestPlayer: null,
                    bestPlayerSchool: null,
                    bestGoalkeeper: null,
                    bestGoalkeeperSchool: null,
                    topScorer: null,
                    topScorerSchool: null,
                    adminCredentials: { username: 'admin', password: '123' },
                    managerCredentials: {}
                };
                showToast('Semua data kejohanan telah ditetapkan semula!', 'success');
                updateAllViews();
                logout(); // Log out after reset
                location.reload(); // Reload page to ensure clean state
            } catch (error) {
                console.error("Ralat menetapkan semula data kejohanan:", error);
                showToast('Ralat menetapkan semula data kejohanan.', 'error');
            }
        }

        // =====================================================================================================
        // END FIREBASE INTEGRATION FUNCTIONS
        // =====================================================================================================


        // Global variable for countdown interval
        let countdownInterval;

        // Utility function for toast notifications
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast-notification');
            toast.textContent = message;
            toast.className = `toast-notification show ${type}`; // Add type class
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000); // Hide after 3 seconds
        }

        // Function to handle tab changes
        function changeTab(tabId) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Deactivate all navigation links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });

            // Show the selected tab content
            document.getElementById(tabId).classList.add('active');

            // Activate the corresponding navigation link (both desktop and mobile)
            document.querySelectorAll(`.nav-link[data-tab="${tabId}"]`).forEach(link => {
                link.classList.add('active');
            });

            // Close mobile menu if open
            const navOverlay = document.getElementById('nav-overlay');
            const hamburgerMenu = document.getElementById('hamburger-menu');
            const nav = document.querySelector('nav');

            if (navOverlay.classList.contains('active')) {
                navOverlay.classList.remove('active');
                hamburgerMenu.classList.remove('active', 'active-overlay');
                nav.classList.remove('nav-fixed-on-mobile');
                document.body.style.overflow = ''; // Re-enable scrolling
            }

            // Update views specific to the tab
            if (tabId === 'standings') {
                updateStandings();
            } else if (tabId === 'fixtures') {
                updateFixtures();
            } else if (tabId === 'knockout') {
                updateKnockoutBracket();
            } else if (tabId === 'finalResult') {
                updateFinalResults();
            } else if (tabId === 'admin') {
                // Ensure correct panel is shown based on login status
                if (currentUser) {
                    showAdminOrManagerPanel();
                } else {
                    document.getElementById('login-section').style.display = 'block';
                    document.getElementById('admin-content').style.display = 'none';
                    document.getElementById('manager-content').style.display = 'none';
                }
            } else if (tabId === 'home') {
                 // Check if countdown should be displayed
                if (tournamentData.countdownStartTime && !tournamentData.groupDivisionDone) {
                    document.getElementById('countdown-section').style.display = 'block';
                    clearInterval(countdownInterval); // Clear any existing interval
                    updateCountdownDisplay(); // Call once immediately
                    countdownInterval = setInterval(updateCountdownDisplay, 1000); // Update every second
                } else {
                    document.getElementById('countdown-section').style.display = 'none';
                }
            }
        }

        // Hamburger menu functionality
        document.getElementById('hamburger-menu').addEventListener('click', () => {
            const navOverlay = document.getElementById('nav-overlay');
            const hamburgerMenu = document.getElementById('hamburger-menu');
            const nav = document.querySelector('nav');

            navOverlay.classList.toggle('active');
            hamburgerMenu.classList.toggle('active');
            hamburgerMenu.classList.toggle('active-overlay'); // Add this class to fix hamburger
            nav.classList.toggle('nav-fixed-on-mobile'); // Add this class to fix nav bar

            // Disable scrolling on body when overlay is active
            if (navOverlay.classList.contains('active')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        });

        // Event listeners for navigation links
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const tabId = this.getAttribute('data-tab');
                changeTab(tabId);
            });
        });


        // Function to update the countdown display
        function updateCountdownDisplay() {
            const countdownTimerElement = document.getElementById('countdown-timer');
            const countdownMessageElement = document.getElementById('countdown-message');
            const now = new Date();

            if (tournamentData.countdownStartTime && !tournamentData.groupDivisionDone) {
                const timeRemaining = tournamentData.countdownStartTime.getTime() + (tournamentData.countdownDurationInput * 1000) - now.getTime();

                if (timeRemaining > 0) {
                    const days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);

                    countdownTimerElement.textContent =
                        `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                    countdownMessageElement.textContent = "Kira Detik Sehingga Pembahagian Kumpulan";
                    document.getElementById('countdown-section').style.display = 'block';
                } else {
                    clearInterval(countdownInterval);
                    countdownTimerElement.textContent = "00:00:00";
                    countdownMessageElement.textContent = "Pembahagian Kumpulan Sedang Berlangsung...";
                    // Automatically trigger group division and fixture generation
                    if (!tournamentData.groupDivisionDone) {
                        autoDivideGroupsAndGenerateFixtures();
                    }
                }
            } else {
                clearInterval(countdownInterval);
                document.getElementById('countdown-section').style.display = 'none';
            }
        }


        // Dummy data structure (will be loaded/saved from/to Firebase)
        // This is the default state if no data is found in Firestore

        // Utility function to get team logo
        function getTeamLogo(teamName) {
            const team = tournamentData.allParticipatingTeams.find(t => t.name === teamName);
            return team ? team.logo : 'https://placehold.co/50x50/cccccc/000000?text=LOGO';
        }

        // Function to update the participating teams list on Home tab
        function updateParticipatingTeamsList() {
            const teamListContainer = document.getElementById('participating-team-list');
            teamListContainer.innerHTML = ''; // Clear existing cards

            if (tournamentData.allParticipatingTeams.length === 0) {
                teamListContainer.innerHTML = '<p style="text-align: center; width: 100%; color: #777;">Tiada pasukan ditambahkan lagi.</p>';
                return;
            }

            tournamentData.allParticipatingTeams.forEach(team => {
                const teamCard = document.createElement('div');
                teamCard.classList.add('team-card');
                teamCard.innerHTML = `
                    <img src="${team.logo}" alt="${team.name} Logo" onerror="this.onerror=null;this.src='https://placehold.co/80x80/cccccc/000000?text=LOGO';"/>
                    <h4>${team.name}</h4>
                    <span class="team-info-link" onclick="showTeamInfo('${team.name}')">Info Pengurus</span>
                `;
                teamListContainer.appendChild(teamCard);
            });
        }

        // Function to show team info in a modal (simplified, for demonstration)
        function showTeamInfo(teamName) {
            const team = tournamentData.allParticipatingTeams.find(t => t.name === teamName);
            if (team) {
                let playersList = team.players && team.players.length > 0
                    ? team.players.map(p => `<li>${p.name} (Jersi: ${p.jerseyNo})</li>`).join('')
                    : '<li>Tiada pemain dimasukkan.</li>';

                let managerInfo = `
                    <p><strong>Nama Pengurus:</strong> ${team.managerName || 'Belum dimasukkan'}</p>
                    <p><strong>Telefon:</strong> ${team.managerPhone || 'Belum dimasukkan'}</p>
                `;

                showToast(`
                    <strong>${team.name}</strong><br>
                    ${managerInfo}
                    <p><strong>Pemain:</strong></p>
                    <ul style="list-style-type: none; padding: 0; text-align: left;">${playersList}</ul>
                `, 'info');
            }
        }


        // Function to calculate and update standings
        function updateStandings() {
            const groupAStandingsBody = document.getElementById('groupA-standings-body');
            const groupBStandingsBody = document.getElementById('groupB-standings-body');

            // Clear previous standings
            groupAStandingsBody.innerHTML = '';
            groupBStandingsBody.innerHTML = '';

            // Sort teams and populate tables
            populateStandingsTable(tournamentData.teams.A, groupAStandingsBody);
            populateStandingsTable(tournamentData.teams.B, groupBStandingsBody);
        }

        function populateStandingsTable(teams, tableBody) {
            if (teams.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="10" style="text-align: center; color: #777;">Tiada pasukan dalam kumpulan ini atau jadual belum dijana.</td></tr>';
                return;
            }

            const sortedTeams = sortStandings(teams);

            sortedTeams.forEach((team, index) => {
                const row = tableBody.insertRow();
                row.className = team.qualified ? 'qualified' : ''; // Highlight qualified teams
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td class="team-name"><img src="${getTeamLogo(team.name)}" alt="${team.name} Logo"/> ${team.name}</td>
                    <td>${team.P}</td>
                    <td>${team.M}</td>
                    <td>${team.S}</td>
                    <td>${team.K}</td>
                    <td>${team.J}</td>
                    <td>${team.B}</td>
                    <td>${team.diff}</td>
                    <td>${team.points}</td>
                `;
            });
        }

        function sortStandings(teams) {
            // Sort teams by points, then goal difference, then goals for
            return [...teams].sort((a, b) => {
                if (b.points !== a.points) return b.points - a.points;
                if (b.diff !== a.diff) return b.diff - a.diff;
                return b.J - a.J;
            });
        }

        // Function to update the match fixtures display
        function updateFixtures() {
            const groupA_fixturesContainer = document.getElementById('groupA-fixtures');
            const groupB_fixturesContainer = document.getElementById('groupB-fixtures');

            groupA_fixturesContainer.innerHTML = '';
            groupB_fixturesContainer.innerHTML = '';

            const groupAMatches = tournamentData.matches.filter(m => m.group === 'A' && m.type === 'group');
            const groupBMatches = tournamentData.matches.filter(m => m.group === 'B' && m.type === 'group');

            if (groupAMatches.length === 0) {
                groupA_fixturesContainer.innerHTML = '<p style="text-align: center; width: 100%; color: #777;">Jadual kumpulan A belum dijana.</p>';
            } else {
                populateMatchFixtures(groupAMatches, groupA_fixturesContainer);
            }

            if (groupBMatches.length === 0) {
                groupB_fixturesContainer.innerHTML = '<p style="text-align: center; width: 100%; color: #777;">Jadual kumpulan B belum dijana.</p>';
            } else {
                populateMatchFixtures(groupBMatches, groupB_fixturesContainer);
            }
        }

        function populateMatchFixtures(matches, fixtureContainer) {
            matches.sort((a, b) => {
                const dateA = new Date(`${a.date}T${a.time}`);
                const dateB = new Date(`${b.date}T${b.time}`);
                return dateA - dateB;
            });

            matches.forEach(match => {
                const matchCard = document.createElement('div');
                matchCard.classList.add('match-card');
                matchCard.classList.add(match.played ? 'played' : 'upcoming');

                const homeLogo = getTeamLogo(match.homeTeam);
                const awayLogo = getTeamLogo(match.awayTeam);

                let homeScoreDisplay = match.homeScore !== null ? match.homeScore : '-';
                let awayScoreDisplay = match.awayScore !== null ? match.awayScore : '-';

                let homeScoreClass = '';
                let awayScoreClass = '';
                if (match.played) {
                    if (match.homeScore > match.awayScore) {
                        homeScoreClass = 'winning-score';
                    } else if (match.awayScore > match.homeScore) {
                        awayScoreClass = 'winning-score';
                    }
                }

                let penaltyDisplay = '';
                if (match.homePenalties !== null && match.awayPenalties !== null) {
                    penaltyDisplay = `<div class="score-penalties">Penalti: (${match.homePenalties} - ${match.awayPenalties})</div>`;
                }

                // Generate match details (goals, cards) for home team
                const homeMatchDetailsHtml = `
                    <div class="team-event-list home-events">
                        ${match.homeGoals.map(g => `<div class="goal"><span class="goal-icon"></span> ${g.player} (Jersi: ${g.jersey}) ${g.minute}'</div>`).join('')}
                        ${match.homeYellowCards.map(c => `<div class="card"><span class="yellow-card-icon"></span> ${c.player} (Jersi: ${c.jersey}) ${c.minute}'</div>`).join('')}
                        ${match.homeRedCards.map(c => `<div class="card"><span class="red-card-icon"></span> ${c.player} (Jersi: ${c.jersey}) ${c.minute}'</div>`).join('')}
                    </div>
                `;

                // Generate match details (goals, cards) for away team
                const awayMatchDetailsHtml = `
                    <div class="team-event-list away-events">
                        ${match.awayGoals.map(g => `<div class="goal"><span class="goal-icon"></span> ${g.player} (Jersi: ${g.jersey}) ${g.minute}'</div>`).join('')}
                        ${match.awayYellowCards.map(c => `<div class="card"><span class="yellow-card-icon"></span> ${c.player} (Jersi: ${c.jersey}) ${c.minute}'</div>`).join('')}
                        ${match.awayRedCards.map(c => `<div class="card"><span class="red-card-icon"></span> ${c.player} (Jersi: ${c.jersey}) ${c.minute}'</div>`).join('')}
                    </div>
                `;

                matchCard.innerHTML = `
                    <div class="match-date-time">${match.date instanceof Date ? match.date.toISOString().slice(0, 10) : match.date} ${match.time}</div>
                    <div class="teams-line">
                        <span class="team-name-display">
                            <img src="${homeLogo}" alt="${match.homeTeam} Logo" onerror="this.onerror=null;this.src='https://placehold.co/50x50/cccccc/000000?text=LOGO';"/>
                            ${match.homeTeam}
                        </span>
                        <span class="vs">vs</span>
                        <span class="team-name-display">
                            ${match.awayTeam}
                            <img src="${awayLogo}" alt="${match.awayTeam} Logo" onerror="this.onerror=null;this.src='https://placehold.co/50x50/cccccc/000000?text=LOGO';"/>
                        </span>
                    </div>
                    <div class="scores-line">
                        <span class="score ${homeScoreClass}">${match.played ? homeScoreDisplay : ''}</span>
                        <span class="score ${awayScoreClass}">${match.played ? awayScoreDisplay : ''}</span>
                    </div>
                    ${penaltyDisplay}
                    ${match.played ? `<div class="match-events-container">
                        <div class="home-events-column">
                            ${homeMatchDetailsHtml}
                        </div>
                        <div class="away-events-column">
                            ${awayMatchDetailsHtml}
                        </div>
                    </div>` : ''}
                `;
                fixtureContainer.appendChild(matchCard);
            });
        }

        function areAllGroupMatchesPlayedInGroup(groupName) {
            const groupMatches = tournamentData.matches.filter(m => m.type === 'group' && m.group === groupName);
            // Jika tiada perlawanan kumpulan, ia tidak dianggap "semua dimainkan"
            if (groupMatches.length === 0) {
                return false;
            }
            return groupMatches.every(m => m.played);
        }

        function updateKnockoutBracket() {
            const bracketContainer = document.getElementById('knockout-bracket');
            if (!bracketContainer) return;
            bracketContainer.innerHTML = ''; // Clear existing bracket

            // Check if all group matches are played before populating the bracket automatically
            const allGroupMatchesPlayed = areAllGroupMatchesPlayedInGroup('A') && areAllGroupMatchesPlayedInGroup('B');

            if (!allGroupMatchesPlayed) {
                bracketContainer.innerHTML = '<p style="text-align: center; color: #777; font-style: italic; margin-top: 50px;">Carta Kalah Mati akan dipaparkan setelah semua perlawanan peringkat kumpulan selesai dimasukkan skor.</p>';
                return;
            }

            const qualifiedA = sortStandings(tournamentData.teams.A).filter(t => t.qualified);
            const qualifiedB = sortStandings(tournamentData.teams.B).filter(t => t.qualified);

            if (qualifiedA.length < 2 || qualifiedB.length < 2) {
                bracketContainer.innerHTML = '<p style="text-align: center; color: #777; font-style: italic; margin-top: 50px;">Tidak cukup pasukan yang layak dari peringkat kumpulan untuk menjana peringkat kalah mati (perlukan 2 dari setiap kumpulan).</p>';
                return;
            }

            // Ensure knockout matches exist, if not, create default ones with correct teams
            let sf1 = tournamentData.matches.find(m => m.id === 'SF1');
            let sf2 = tournamentData.matches.find(m => m.id === 'SF2');
            let finalMatch = tournamentData.matches.find(m => m.id === 'Final');

            if (!sf1 || !sf2 || !finalMatch) {
                // If they don't exist, create them with default times and qualified teams
                addDefaultKnockoutMatches(); // This will create them with placeholder times
                // Now retrieve them again as they've been added
                sf1 = tournamentData.matches.find(m => m.id === 'SF1');
                sf2 = tournamentData.matches.find(m => m.id === 'SF2');
                finalMatch = tournamentData.matches.find(m => m.id === 'Final');
            }

            // Always update home/away teams for SF based on qualified teams
            sf1.homeTeam = qualifiedA[0].name;
            sf1.awayTeam = qualifiedB[1].name;
            sf2.homeTeam = qualifiedB[0].name;
            sf2.awayTeam = qualifiedA[1].name;

            // Update Final match teams based on SF winners if played
            if (sf1.played && sf2.played) {
                const sf1Winner = (sf1.homeScore > sf1.awayScore || (sf1.homeScore === sf1.awayScore && sf1.homePenalties > sf1.awayPenalties)) ? sf1.homeTeam : sf1.awayTeam;
                const sf2Winner = (sf2.homeScore > sf2.awayScore || (sf2.homeScore === sf2.awayScore && sf2.homePenalties > sf2.awayPenalties)) ? sf2.homeTeam : sf2.awayTeam;
                finalMatch.homeTeam = sf1Winner;
                finalMatch.awayTeam = sf2Winner;
            } else {
                finalMatch.homeTeam = 'Winner SF1';
                finalMatch.awayTeam = 'Winner SF2';
            }


            // Fungsi pembantu untuk memaparkan nama pasukan atau placeholder dengan gaya
            const renderTeamNameWithLogo = (teamName) => {
                const isPlaceholder = teamName.includes('Winner SF');
                const teamLogo = getTeamLogo(teamName);
                const teamClass = isPlaceholder ? 'placeholder-team' : '';
                return `<span class="team-name ${teamClass}"><img src="${teamLogo}" alt="${teamName} Logo" onerror="this.onerror=null;this.src='https://placehold.co/50x50/cccccc/000000?text=LOGO';"/> ${teamName}</span>`;
            };

            // Paparkan Separuh Akhir
            const semiFinalRound = document.createElement('div');
            semiFinalRound.className = 'bracket-round';
            semiFinalRound.innerHTML = '<h3>Separuh Akhir</h3>';
            [sf1, sf2].forEach(match => {
                const matchDiv = document.createElement('div');
                matchDiv.className = 'bracket-match';
                let scoreDisplay = match.played ? `${match.homeScore} - ${match.awayScore}` : 'vs';
                if (match.played && match.homePenalties !== null && match.awayPenalties !== null) {
                    scoreDisplay += `<br>(Penalti: ${match.homePenalties} - ${match.awayPenalties})`;
                }
                matchDiv.innerHTML = `
                    ${renderTeamNameWithLogo(match.homeTeam)}
                    <p class="score">${scoreDisplay}</p>
                    ${renderTeamNameWithLogo(match.awayTeam)}
                    <p class="date">${match.date instanceof Date ? match.date.toISOString().slice(0, 10) : match.date} ${match.time}</p>
                `;
                semiFinalRound.appendChild(matchDiv);
            });
            bracketContainer.appendChild(semiFinalRound);

            // Paparkan Akhir (satu perlawanan)
            const finalRound = document.createElement('div');
            finalRound.className = 'bracket-round';
            finalRound.innerHTML = '<h3>Akhir</h3>';
            const finalMatchDiv = document.createElement('div');
            finalMatchDiv.className = 'bracket-match final-match';
            let finalScoreDisplay = finalMatch.played ? `${finalMatch.homeScore} - ${finalMatch.awayScore}` : 'vs';
            if (finalMatch.played && finalMatch.homePenalties !== null && finalMatch.awayPenalties !== null) {
                finalScoreDisplay += `<br>(Penalti: ${finalMatch.homePenalties} - ${finalMatch.awayPenalties})`;
            }
            finalMatchDiv.innerHTML = `
                ${renderTeamNameWithLogo(finalMatch.homeTeam)}
                <p class="score">${finalScoreDisplay}</p>
                ${renderTeamNameWithLogo(finalMatch.awayTeam)}
                <p class="date">${finalMatch.date instanceof Date ? finalMatch.date.toISOString().slice(0, 10) : finalMatch.date} ${finalMatch.time}</p>
            `;
            finalRound.appendChild(finalMatchDiv);
            bracketContainer.appendChild(finalRound);

            saveTournamentData(); // Save updated knockout teams
        }

        function addDefaultKnockoutMatches() {
            // Check if SF1, SF2, Final already exist
            let sf1Exists = tournamentData.matches.some(m => m.id === 'SF1');
            let sf2Exists = tournamentData.matches.some(m => m.id === 'SF2');
            let finalExists = tournamentData.matches.some(m => m.id === 'Final');

            // Default dates/times (can be updated by admin later)
            const defaultDate = new Date().toISOString().slice(0, 10);
            const defaultTime = '12:00';

            if (!sf1Exists) {
                tournamentData.matches.push({
                    id: 'SF1',
                    type: 'knockout',
                    homeTeam: 'Winner Group A', // Placeholder
                    awayTeam: 'Runner-up Group B', // Placeholder
                    date: defaultDate,
                    time: '10:00',
                    homeScore: null,
                    awayScore: null,
                    played: false,
                    homePenalties: null,
                    awayPenalties: null,
                    homeGoals: [], awayGoals: [],
                    homeYellowCards: [], awayYellowCards: [],
                    homeRedCards: [], awayRedCards: []
                });
            }
            if (!sf2Exists) {
                tournamentData.matches.push({
                    id: 'SF2',
                    type: 'knockout',
                    homeTeam: 'Winner Group B', // Placeholder
                    awayTeam: 'Runner-up Group A', // Placeholder
                    date: defaultDate,
                    time: '14:00',
                    homeScore: null,
                    awayScore: null,
                    played: false,
                    homePenalties: null,
                    awayPenalties: null,
                    homeGoals: [], awayGoals: [],
                    homeYellowCards: [], awayYellowCards: [],
                    homeRedCards: [], awayRedCards: []
                });
            }
            if (!finalExists) {
                tournamentData.matches.push({
                    id: 'Final',
                    type: 'knockout',
                    homeTeam: 'Winner SF1', // Placeholder
                    awayTeam: 'Winner SF2', // Placeholder
                    date: defaultDate,
                    time: '16:00',
                    homeScore: null,
                    awayScore: null,
                    played: false,
                    homePenalties: null,
                    awayPenalties: null,
                    homeGoals: [], awayGoals: [],
                    homeYellowCards: [], awayYellowCards: [],
                    homeRedCards: [], awayRedCards: []
                });
            }
            saveTournamentData();
        }

        function updateFinalResults() {
            const finalWinnerTeamElement = document.getElementById('final-winner-team');
            const finalWinnerLogoElement = document.getElementById('final-winner-logo');
            const finalRunnerUpTeamElement = document.getElementById('final-runner-up-team');
            const finalRunnerUpLogoElement = document.getElementById('final-runner-up-logo');
            const thirdPlaceTeamsContainer = document.getElementById('third-place-teams-container');

            finalWinnerTeamElement.textContent = tournamentData.finalWinner ? tournamentData.finalWinner : 'Belum Ditentukan';
            finalWinnerLogoElement.src = tournamentData.finalWinner ? getTeamLogo(tournamentData.finalWinner) : 'https://placehold.co/100x100/cccccc/000000?text=LOGO';

            finalRunnerUpTeamElement.textContent = tournamentData.finalRunnerUp ? tournamentData.finalRunnerUp : 'Belum Ditentukan';
            finalRunnerUpLogoElement.src = tournamentData.finalRunnerUp ? getTeamLogo(tournamentData.finalRunnerUp) : 'https://placehold.co/100x100/cccccc/000000?text=LOGO';

            thirdPlaceTeamsContainer.innerHTML = ''; // Clear existing cards
            if (tournamentData.thirdPlaceTeams && tournamentData.thirdPlaceTeams.length > 0) {
                tournamentData.thirdPlaceTeams.forEach(teamName => {
                    const teamCard = document.createElement('div');
                    teamCard.classList.add('third-place-card');
                    teamCard.innerHTML = `
                        <img src="${getTeamLogo(teamName)}" alt="${teamName} Logo" onerror="this.onerror=null;this.src='https://placehold.co/80x80/cccccc/000000?text=LOGO';"/>
                        <h4>${teamName}</h4>
                    `;
                    thirdPlaceTeamsContainer.appendChild(teamCard);
                });
            } else {
                thirdPlaceTeamsContainer.innerHTML = '<p style="text-align: center; width: 100%; color: #777;">Belum Ditentukan</p>';
            }

            // Update individual awards
            document.getElementById('best-player-name').textContent = tournamentData.bestPlayer || 'Belum Ditentukan';
            document.getElementById('best-player-school').textContent = tournamentData.bestPlayerSchool || 'Belum Ditentukan';
            document.getElementById('best-goalkeeper-name').textContent = tournamentData.bestGoalkeeper || 'Belum Ditentukan';
            document.getElementById('best-goalkeeper-school').textContent = tournamentData.bestGoalkeeperSchool || 'Belum Ditentukan';
            document.getElementById('top-scorer-name').textContent = tournamentData.topScorer || 'Belum Ditentukan';
            document.getElementById('top-scorer-school').textContent = tournamentData.topScorerSchool || 'Belum Ditentukan';
        }

        // =========================================================
        // ADMIN PANEL FUNCTIONS
        // =========================================================

        function updateAdminPanel() {
            populateMatchSelect();
            populateTeamSelects();
            document.getElementById('enable-extra-time').checked = tournamentData.enableExtraTime;

            // Pre-fill individual awards
            document.getElementById('best-player-input').value = tournamentData.bestPlayer || '';
            document.getElementById('best-player-school-input').value = tournamentData.bestPlayerSchool || '';
            document.getElementById('best-goalkeeper-input').value = tournamentData.bestGoalkeeper || '';
            document.getElementById('best-goalkeeper-school-input').value = tournamentData.bestGoalkeeperSchool || '';
            document.getElementById('top-scorer-input').value = tournamentData.topScorer || '';
            document.getElementById('top-scorer-school-input').value = tournamentData.topScorerSchool || '';

            // Pre-fill header logo URL
            if (tournamentData.headerLogo && tournamentData.headerLogo !== 'https://placehold.co/100x100/cccccc/000000?text=LOGO') {
                 // For file input, you can't pre-fill value for security reasons.
                 // Maybe show a preview of the current logo if it's a data URL or external URL
            }
        }

        function populateMatchSelect() {
            const matchSelect = document.getElementById('match-select');
            const editKnockoutMatchSelect = document.getElementById('edit-knockout-match-select');
            matchSelect.innerHTML = '<option value="">-- Pilih Perlawanan --</option>';
            editKnockoutMatchSelect.innerHTML = '<option value="">-- Pilih Perlawanan --</option>';

            const sortedMatches = [...tournamentData.matches].sort((a, b) => {
                const dateA = new Date(`${a.date}T${a.time}`);
                const dateB = new Date(`${b.date}T${b.time}`);
                return dateA - dateB;
            });

            sortedMatches.forEach(match => {
                const option = document.createElement('option');
                option.value = match.id;
                option.textContent = `${match.id} - ${match.homeTeam} vs ${match.awayTeam} (${match.date instanceof Date ? match.date.toISOString().slice(0, 10) : match.date} ${match.time})`;
                matchSelect.appendChild(option);

                // Populate knockout match select separately
                if (match.type === 'knockout') {
                    const knockoutOption = document.createElement('option');
                    knockoutOption.value = match.id;
                    knockoutOption.textContent = `${match.id} - ${match.homeTeam} vs ${match.awayTeam} (${match.date instanceof Date ? match.date.toISOString().slice(0, 10) : match.date} ${match.time})`;
                    editKnockoutMatchSelect.appendChild(knockoutOption);
                }
            });
        }

        function populateTeamSelects() {
            const managerTeamSelect = document.getElementById('manager-team-select');
            const renameTeamSelect = document.getElementById('rename-team-select');
            managerTeamSelect.innerHTML = '<option value="">-- Pilih Pasukan --</option>';
            renameTeamSelect.innerHTML = '<option value="">-- Pilih Pasukan --</option>';

            tournamentData.allParticipatingTeams.forEach(team => {
                const option1 = document.createElement('option');
                option1.value = team.name;
                option1.textContent = team.name;
                managerTeamSelect.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = team.name;
                option2.textContent = team.name;
                renameTeamSelect.appendChild(option2);
            });
        }

        function displayMatchPreview() {
            const matchSelect = document.getElementById('match-select');
            const selectedMatchId = matchSelect.value;
            const matchPreviewDiv = document.getElementById('match-preview');
            const scoreHomeInput = document.getElementById('score-home');
            const scoreAwayInput = document.getElementById('score-away');
            const penaltyInputsDiv = document.getElementById('penalty-inputs');
            const penaltyHomeInput = document.getElementById('penalty-home');
            const penaltyAwayInput = document.getElementById('penalty-away');

            if (selectedMatchId) {
                const match = tournamentData.matches.find(m => m.id === selectedMatchId);
                if (!match) return;

                const homeLogo = getTeamLogo(match.homeTeam);
                const awayLogo = getTeamLogo(match.awayTeam);

                matchPreviewDiv.innerHTML = `
                    <p style="text-align: center; font-weight: 600; margin-bottom: 10px;">Preview Perlawanan:</p>
                    <div style="display: flex; justify-content: center; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <span style="display: flex; align-items: center; gap: 5px;"><img src="${homeLogo}" alt="${match.homeTeam} Logo" style="width: 25px; height: 25px; border-radius: 50%;"> ${match.homeTeam}</span>
                        <span style="font-weight: bold;">vs</span>
                        <span style="display: flex; align-items: center; gap: 5px;">${match.awayTeam} <img src="${awayLogo}" alt="${match.awayTeam} Logo" style="width: 25px; height: 25px; border-radius: 50%;"></span>
                    </div>
                    <p style="text-align: center;">Tarikh: ${match.date instanceof Date ? match.date.toISOString().slice(0, 10) : match.date}, Masa: ${match.time}</p>
                `;
                matchPreviewDiv.style.display = 'block';

                scoreHomeInput.value = match.homeScore !== null ? match.homeScore : 0;
                scoreAwayInput.value = match.awayScore !== null ? match.awayScore : 0;

                if (match.type === 'knockout' && tournamentData.enableExtraTime) {
                    penaltyInputsDiv.style.display = 'block';
                    penaltyHomeInput.value = match.homePenalties !== null ? match.homePenalties : 0;
                    penaltyAwayInput.value = match.awayPenalties !== null ? match.awayPenalties : 0;
                } else {
                    penaltyInputsDiv.style.display = 'none';
                    penaltyHomeInput.value = 0;
                    penaltyAwayInput.value = 0;
                }

                // Auto-generate event inputs based on current scores or existing data
                autoGenerateEventInputs('home', 'goal', match);
                autoGenerateEventInputs('home', 'yellow', match);
                autoGenerateEventInputs('home', 'red', match);
                autoGenerateEventInputs('away', 'goal', match);
                autoGenerateEventInputs('away', 'yellow', match);
                autoGenerateEventInputs('away', 'red', match);
            } else {
                matchPreviewDiv.style.display = 'none';
                scoreHomeInput.value = 0;
                scoreAwayInput.value = 0;
                penaltyInputsDiv.style.display = 'none';
                penaltyHomeInput.value = 0;
                penaltyAwayInput.value = 0;
                // Clear all dynamic inputs when no match is selected
                document.getElementById('home-goals-input-container').innerHTML = '';
                document.getElementById('away-goals-input-container').innerHTML = '';
                document.getElementById('home-yellow-cards-input-container').innerHTML = '';
                document.getElementById('away-yellow-cards-input-container').innerHTML = '';
                document.getElementById('home-red-cards-input-container').innerHTML = '';
                document.getElementById('away-red-cards-input-container').innerHTML = '';
            }
        }

        /**
         * Automatically generates event input fields (goal/card) based on count.
         * @param {string} teamType - 'home' or 'away'
         * @param {string} eventType - 'goal', 'yellow', 'red'
         * @param {object} [matchData] - Optional: the current match object to pre-fill data.
         */
        function autoGenerateEventInputs(teamType, eventType, matchData = null) {
            const matchSelect = document.getElementById('match-select');
            const selectedMatchId = matchSelect.value;
            if (!selectedMatchId) return; // Do nothing if no match is selected

            const match = matchData || tournamentData.matches.find(m => m.id === selectedMatchId);
            if (!match) return;

            let currentCountInput;
            let container;
            let existingEvents;

            if (eventType === 'goal') {
                currentCountInput = document.getElementById(`score-${teamType}`);
                container = document.getElementById(`${teamType}-goals-input-container`);
                existingEvents = match[`${teamType}Goals`];
            } else if (eventType === 'yellow') {
                currentCountInput = document.getElementById(`${teamType}-yellow-cards-count`);
                container = document.getElementById(`${teamType}-yellow-cards-input-container`);
                existingEvents = match[`${teamType}YellowCards`];
            } else if (eventType === 'red') {
                currentCountInput = document.getElementById(`${teamType}-red-cards-count`);
                container = document.getElementById(`${teamType}-red-cards-input-container`);
                existingEvents = match[`${teamType}RedCards`];
            } else {
                return; // Invalid eventType
            }

            const currentCount = parseInt(currentCountInput.value) || 0;
            const existingInputs = container.querySelectorAll('.event-input-group');

            // Determine which team's players to list
            const teamName = teamType === 'home' ? match.homeTeam : match.awayTeam;
            const teamPlayers = tournamentData.allParticipatingTeams.find(t => t.name === teamName)?.players || [];

            // Remove excess inputs
            for (let i = existingInputs.length - 1; i >= currentCount; i--) {
                existingInputs[i].remove();
            }

            // Add new inputs or re-populate existing ones
            for (let i = 0; i < currentCount; i++) {
                const eventData = existingEvents[i] || { player: '', minute: '' }; // No jersey field here

                if (i < existingInputs.length) {
                    // Update existing input
                    const group = existingInputs[i];
                    const playerSelect = group.querySelector('select[data-field="player"]');
                    const minuteInput = group.querySelector('input[data-field="minute"]');

                    // Re-populate player dropdown with current team's players
                    playerSelect.innerHTML = '<option value="">-- Pilih Pemain --</option>';
                    teamPlayers.forEach(player => {
                        const option = document.createElement('option');
                        option.value = player.name; // Store just player name as value
                        option.textContent = `${player.name} (Jersi: ${player.jerseyNo})`; // Display name and jersey
                        option.setAttribute('data-jersey', player.jerseyNo); // Store jersey as data attribute
                        playerSelect.appendChild(option);
                    });

                    // Select the correct player if it exists
                    if (eventData.player) {
                        const selectedOption = playerSelect.querySelector(`option[value="${eventData.player}"]`);
                        if (selectedOption) {
                            selectedOption.selected = true;
                        } else {
                            // If player not found (e.g., team name changed, player removed), add it as a selected option
                            // and use the stored jersey if available, otherwise '??'
                            const existingOption = document.createElement('option');
                            existingOption.value = eventData.player;
                            existingOption.textContent = `${eventData.player} (Jersi: ${eventData.jersey || '??'}) (Pemain Tidak Ditemui)`;
                            existingOption.selected = true;
                            existingOption.setAttribute('data-jersey', eventData.jersey || '');
                            playerSelect.prepend(existingOption);
                        }
                    }
                    minuteInput.value = eventData.minute || '';

                } else {
                    // Add new input
                    if (eventType === 'goal') {
                        addGoalInput(teamType, teamPlayers, eventData);
                    } else {
                        addCardInput(teamType, eventType, teamName, eventData);
                    }
                }
            }
        }

        // Helper to add goal input fields
        function addGoalInput(teamType, teamPlayers, goal = { player: '', minute: '' }) {
            const container = document.getElementById(`${teamType}-goals-input-container`);
            const div = document.createElement('div');
            div.classList.add('event-input-group');

            // Create minute input FIRST
            const minuteInput = document.createElement('input');
            minuteInput.type = 'number';
            minuteInput.placeholder = 'Minit';
            minuteInput.min = '1';
            minuteInput.max = '90';
            minuteInput.setAttribute('data-field', 'minute');
            minuteInput.value = goal.minute || '';

            // Create player dropdown SECOND
            const playerSelect = document.createElement('select');
            playerSelect.setAttribute('data-field', 'player');
            playerSelect.innerHTML = '<option value="">-- Pilih Pemain --</option>';
            teamPlayers.forEach(player => {
                const option = document.createElement('option');
                option.value = player.name; // Store just player name as value
                option.textContent = `${player.name} (Jersi: ${player.jerseyNo})`; // Display name and jersey
                option.setAttribute('data-jersey', player.jerseyNo); // Store jersey as data attribute
                if (goal.player && goal.player === player.name) {
                    option.selected = true;
                }
                playerSelect.appendChild(option);
            });

            // If the goal.player is not in the current teamPlayers, add it as a selected option
            if (goal.player && !teamPlayers.some(p => p.name === goal.player)) {
                const existingOption = document.createElement('option');
                existingOption.value = goal.player;
                existingOption.textContent = `${goal.player} (Jersi: ${goal.jersey || '??'}) (Pemain Tidak Ditemui)`;
                existingOption.selected = true;
                existingOption.setAttribute('data-jersey', goal.jersey || '');
                playerSelect.prepend(existingOption); // Add to the top
            }

            const removeButton = document.createElement('button');
            removeButton.type = 'button';
            removeButton.classList.add('remove-event-button');
            removeButton.style.backgroundColor = 'var(--danger-color)';
            removeButton.textContent = 'Buang';
            removeButton.onclick = () => {
                div.remove();
                // When a goal is manually removed, decrease the score input
                const scoreInput = document.getElementById(`score-${teamType}`);
                scoreInput.value = Math.max(0, parseInt(scoreInput.value) - 1);
                // Trigger autoGenerateEventInputs to re-sync the view
                autoGenerateEventInputs(teamType, 'goal');
            };

            div.appendChild(minuteInput); // Minit dahulu
            div.appendChild(playerSelect); // Kemudian pemain
            div.appendChild(removeButton);
            container.appendChild(div);
        }

        // Helper to add card input fields
        function addCardInput(teamType, cardType, teamName, card = { player: '', minute: '' }) {
            const container = document.getElementById(`${teamType}-${cardType}-cards-input-container`);
            const div = document.createElement('div');
            div.classList.add('event-input-group');

            const teamPlayers = tournamentData.allParticipatingTeams.find(t => t.name === teamName)?.players || [];

            // Create minute input FIRST
            const minuteInput = document.createElement('input');
            minuteInput.type = 'number';
            minuteInput.placeholder = 'Minit';
            minuteInput.min = '1';
            minuteInput.max = '90';
            minuteInput.setAttribute('data-field', 'minute');
            minuteInput.value = card.minute || '';

            // Create player dropdown SECOND
            const playerSelect = document.createElement('select');
            playerSelect.setAttribute('data-field', 'player');
            playerSelect.innerHTML = '<option value="">-- Pilih Pemain --</option>';
            teamPlayers.forEach(player => {
                const option = document.createElement('option');
                option.value = player.name; // Store just player name as value
                option.textContent = `${player.name} (Jersi: ${player.jerseyNo})`; // Display name and jersey
                option.setAttribute('data-jersey', player.jerseyNo); // Store jersey as data attribute
                if (card.player && card.player === player.name) {
                    option.selected = true;
                }
                playerSelect.appendChild(option);
            });

            // If the card.player is not in the current teamPlayers, add it as a selected option
            if (card.player && !teamPlayers.some(p => p.name === card.player)) {
                const existingOption = document.createElement('option');
                existingOption.value = card.player;
                existingOption.textContent = `${card.player} (Jersi: ${card.jersey || '??'}) (Pemain Tidak Ditemui)`;
                existingOption.selected = true;
                existingOption.setAttribute('data-jersey', card.jersey || '');
                playerSelect.prepend(existingOption);
            }

            const removeButton = document.createElement('button');
            removeButton.type = 'button';
            removeButton.classList.add('remove-event-button');
            removeButton.style.backgroundColor = 'var(--danger-color)';
            removeButton.textContent = 'Buang';
            removeButton.onclick = () => {
                div.remove();
                // When a card is manually removed, decrease the card count input
                const cardCountInput = document.getElementById(`${teamType}-${cardType}-cards-count`);
                cardCountInput.value = Math.max(0, parseInt(cardCountInput.value) - 1);
                // Trigger autoGenerateEventInputs to re-sync the view
                autoGenerateEventInputs(teamType, cardType);
            };

            div.appendChild(minuteInput); // Minit dahulu
            div.appendChild(playerSelect); // Kemudian pemain
            div.appendChild(removeButton);
            container.appendChild(div);
        }

        // Helper to read dynamic inputs
        function readDynamicInputs(containerId) {
            const container = document.getElementById(containerId);
            const inputs = [];
            container.querySelectorAll('.event-input-group').forEach(group => {
                const playerSelect = group.querySelector('select[data-field="player"]');
                const minuteInput = group.querySelector('input[data-field="minute"]');

                const player = playerSelect ? playerSelect.value.trim() : '';
                const minute = minuteInput ? minuteInput.value.trim() : '';
                // Get jersey from the selected option's data-jersey attribute
                const selectedOption = playerSelect.options[playerSelect.selectedIndex];
                const jersey = selectedOption ? selectedOption.dataset.jersey : '';

                if (player && minute) {
                    inputs.push({ player, jersey: parseInt(jersey), minute: parseInt(minute) });
                }
            });
            return inputs;
        }


        // Update Match Result
        document.getElementById('updateMatchResultBtn').addEventListener('click', updateMatchResult);

        function updateMatchResult() {
            const matchSelect = document.getElementById('match-select');
            const selectedMatchId = matchSelect.value;
            const scoreHome = parseInt(document.getElementById('score-home').value);
            const scoreAway = parseInt(document.getElementById('score-away').value);
            const penaltyHome = parseInt(document.getElementById('penalty-home').value);
            const penaltyAway = parseInt(document.getElementById('penalty-away').value);

            if (!selectedMatchId) {
                showToast('Sila pilih perlawanan untuk dikemas kini.', 'error');
                return;
            }

            if (isNaN(scoreHome) || isNaN(scoreAway) || scoreHome < 0 || scoreAway < 0) {
                showToast('Jaringan tidak sah. Sila masukkan nombor positif.', 'error');
                return;
            }

            const match = tournamentData.matches.find(m => m.id === selectedMatchId);

            // Batalkan mata sebelumnya sebelum menerapkan yang baru jika perlawanan sudah dimainkan
            if (match.played) {
                revertMatchResults(match);
            }

            match.homeScore = scoreHome;
            match.awayScore = scoreAway;
            match.played = true;

            if (match.type === 'knockout') {
                if (scoreHome === scoreAway) {
                    if (isNaN(penaltyHome) || isNaN(penaltyAway) || penaltyHome < 0 || penaltyAway < 0) {
                        showToast('Jaringan penalti tidak sah. Sila masukkan nombor positif.', 'error');
                        match.played = false; // Mark as not played if penalty is invalid
                        return;
                    }
                    match.homePenalties = penaltyHome;
                    match.awayPenalties = penaltyAway;
                } else {
                    match.homePenalties = null;
                    match.awayPenalties = null;
                }
            } else {
                match.homePenalties = null;
                match.awayPenalties = null;
            }

            // Collect goals and cards
            match.homeGoals = readDynamicInputs('home-goals-input-container');
            match.awayGoals = readDynamicInputs('away-goals-input-container');
            match.homeYellowCards = readDynamicInputs('home-yellow-cards-input-container');
            match.awayYellowCards = readDynamicInputs('away-yellow-cards-input-container');
            match.homeRedCards = readDynamicInputs('home-red-cards-input-container');
            match.awayRedCards = readDynamicInputs('away-red-cards-input-container');


            applyMatchResults(match);
            tournamentData.lastUpdatedMatch = { ...match }; // Store a copy of the updated match for quick display
            saveTournamentData(); // Save to Firestore
            updateAllViews();
            populateMatchSelect(); // Re-populate to reflect updated matches
            showToast('Keputusan perlawanan berjaya dikemas kini!', 'success');
        }

        // Apply results to standings
        function applyMatchResults(match) {
            const homeTeam = tournamentData.allParticipatingTeams.find(t => t.name === match.homeTeam);
            const awayTeam = tournamentData.allParticipatingTeams.find(t => t.name === match.awayTeam);

            if (!homeTeam || !awayTeam) return;

            homeTeam.P++; // Played games
            awayTeam.P++; // Played games

            homeTeam.J += match.homeScore;
            homeTeam.B += match.awayScore;
            homeTeam.diff = homeTeam.J - homeTeam.B;

            awayTeam.J += match.awayScore;
            awayTeam.B += match.homeScore;
            awayTeam.diff = awayTeam.J - awayTeam.B;

            if (match.homeScore > match.awayScore) {
                homeTeam.M++; // Wins
                homeTeam.points += 3; // 3 points for win
                awayTeam.K++; // Losses
            } else if (match.awayScore > match.homeScore) {
                awayTeam.M++; // Wins
                awayTeam.points += 3;
                homeTeam.K++; // Losses
            } else {
                homeTeam.S++; // Draws
                awayTeam.S++; // Draws
                homeTeam.points += 1; // 1 point for draw
                awayTeam.points += 1;
            }

            // Update qualified status based on group standings
            updateQualifiedStatus();
        }

        // Revert results (for re-entering scores)
        function revertMatchResults(match) {
            const homeTeam = tournamentData.allParticipatingTeams.find(t => t.name === match.homeTeam);
            const awayTeam = tournamentData.allParticipatingTeams.find(t => t.name === match.awayTeam);

            if (!homeTeam || !awayTeam) return;

            homeTeam.P--;
            awayTeam.P--;

            homeTeam.J -= match.homeScore;
            homeTeam.B -= match.awayScore;
            homeTeam.diff = homeTeam.J - homeTeam.B;

            awayTeam.J -= match.awayScore;
            awayTeam.B -= match.homeScore;
            awayTeam.diff = awayTeam.J - awayTeam.B;

            if (match.homeScore > match.awayScore) {
                homeTeam.M--;
                homeTeam.points -= 3;
                awayTeam.K--;
            } else if (match.awayScore > match.homeScore) {
                awayTeam.M--;
                awayTeam.points -= 3;
                homeTeam.K--;
            } else {
                homeTeam.S--;
                awayTeam.S--;
                homeTeam.points -= 1;
                awayTeam.points -= 1;
            }

            // Reset scores for the match
            match.homeScore = null;
            match.awayScore = null;
            match.played = false;
            match.homePenalties = null;
            match.awayPenalties = null;
            match.homeGoals = [];
            match.awayGoals = [];
            match.homeYellowCards = [];
            match.awayYellowCards = [];
            match.homeRedCards = [];
            match.awayRedCards = [];

            // Update qualified status after revert
            updateQualifiedStatus();
        }

        // Update qualified status for teams (top 2 from each group)
        function updateQualifiedStatus() {
            if (!tournamentData.groupDivisionDone) return;

            const sortedGroupA = sortStandings(tournamentData.teams.A);
            const sortedGroupB = sortStandings(tournamentData.teams.B);

            // Reset all qualified statuses first
            tournamentData.allParticipatingTeams.forEach(team => {
                team.qualified = false;
            });

            if (sortedGroupA.length >= 2) {
                const top2A = sortedGroupA.slice(0, 2);
                top2A.forEach(team => {
                    const fullTeam = tournamentData.allParticipatingTeams.find(t => t.name === team.name);
                    if (fullTeam) fullTeam.qualified = true;
                });
            }
            if (sortedGroupB.length >= 2) {
                const top2B = sortedGroupB.slice(0, 2);
                top2B.forEach(team => {
                    const fullTeam = tournamentData.allParticipatingTeams.find(t => t.name === team.name);
                    if (fullTeam) fullTeam.qualified = true;
                });
            }
            saveTournamentData(); // Save qualified status
        }


        // Group Division and Fixture Generation
        document.getElementById('startGroupDivisionAndGenerateFixturesBtn').addEventListener('click', startCountdownAndGroupDivision);

        function startCountdownAndGroupDivision() {
            const startDateStr = document.getElementById('group-match-date').value;
            const startTimeStr = document.getElementById('group-match-time').value;
            const countdownStartDateStr = document.getElementById('countdown-start-date').value;
            const countdownStartTimeStr = document.getElementById('countdown-start-time').value;
            const countdownDuration = parseInt(document.getElementById('countdown-duration-input').value);

            if (!startDateStr || !startTimeStr || !countdownStartDateStr || !countdownStartTimeStr || isNaN(countdownDuration)) {
                showToast('Sila lengkapkan semua medan tarikh/masa dan tempoh kira detik.', 'error');
                return;
            }

            if (tournamentData.allParticipatingTeams.length < 4) {
                showToast('Sila tambah sekurang-kurangnya 4 pasukan untuk menjana jadual kumpulan.', 'error');
                return;
            }

            // Set countdown start time in tournamentData
            tournamentData.countdownStartTime = new Date(`${countdownStartDateStr}T${countdownStartTimeStr}`);
            tournamentData.countdownDurationInput = countdownDuration;
            tournamentData.groupDivisionDone = false; // Reset if new countdown is started
            tournamentData.matches = tournamentData.matches.filter(m => m.type !== 'group'); // Clear old group matches

            saveTournamentData(); // Save updated countdown info

            // Start countdown display
            clearInterval(countdownInterval); // Clear any existing interval
            updateCountdownDisplay(); // Call once immediately
            countdownInterval = setInterval(updateCountdownDisplay, 1000); // Update every second

            showToast('Kira detik telah dimulakan!', 'success');
        }

        async function autoDivideGroupsAndGenerateFixtures() {
            if (tournamentData.groupDivisionDone) {
                showToast('Pembahagian kumpulan sudah selesai.', 'info');
                return;
            }

            const teams = [...tournamentData.allParticipatingTeams]; // Copy to shuffle
            if (teams.length < 4) {
                showToast('Tidak cukup pasukan untuk pembahagian kumpulan.', 'error');
                return;
            }

            // Shuffle teams randomly
            for (let i = teams.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [teams[i], teams[j]] = [teams[j], teams[i]];
            }

            // Divide into two groups (A and B) as evenly as possible
            tournamentData.teams.A = [];
            tournamentData.teams.B = [];

            teams.forEach((team, index) => {
                const defaultStats = { P: 0, M: 0, S: 0, K: 0, J: 0, B: 0, diff: 0, points: 0, qualified: false };
                if (index % 2 === 0) {
                    tournamentData.teams.A.push({ name: team.name, logo: team.logo, ...defaultStats });
                } else {
                    tournamentData.teams.B.push({ name: team.name, logo: team.logo, ...defaultStats });
                }
            });

            tournamentData.groupDivisionDone = true;
            saveTournamentData(); // Save group division

            // Generate fixtures
            const groupMatchDate = document.getElementById('group-match-date').value;
            const groupMatchTime = document.getElementById('group-match-time').value;
            generateGroupFixtures(groupMatchDate, groupMatchTime);

            showToast('Pembahagian kumpulan dan jadual perlawanan telah dijana!', 'success');
            updateAllViews(); // Update UI
        }


        // Helper function to generate round-robin matches for a single group
        function generateGroupRoundRobin(teams) {
            const n = teams.length;
            let currentTeams = [...teams]; // Work with a mutable copy

            // Add a dummy team if odd number of teams for round-robin calculation
            if (n % 2 !== 0) {
                currentTeams.push('BYE_TEAM_PLACEHOLDER');
            }

            const numTeams = currentTeams.length;
            const rounds = [];

            for (let r = 0; r < numTeams - 1; r++) {
                const currentRoundMatches = [];
                for (let i = 0; i < numTeams / 2; i++) {
                    const home = currentTeams[i];
                    const away = currentTeams[numTeams - 1 - i];
                    if (home !== 'BYE_TEAM_PLACEHOLDER' && away !== 'BYE_TEAM_PLACEHOLDER') {
                        currentRoundMatches.push([home, away]);
                    }
                }
                rounds.push(currentRoundMatches);

                // Rotate teams (except the first one)
                const lastTeam = currentTeams.pop();
                currentTeams.splice(1, 0, lastTeam);
            }
            return rounds;
        }

        /**
         * Menjana dan menetapkan masa kepada perlawanan kumpulan.
         * Dipanggil selepas pembahagian kumpulan selesai.
         * @param {string} startDateStr - Tarikh mula perlawanan pertama.
         * @param {string} startTimeStr - Masa mula perlawanan pertama.
         */
        function generateGroupFixtures(startDateStr, startTimeStr) {
            if (!startDateStr || !startTimeStr) {
                showToast('Sila masukkan tarikh dan masa mula perlawanan kumpulan.', 'error');
                return;
            }

            if (tournamentData.allParticipatingTeams.length < 4) {
                showToast('Sila tambah sekurang-kurangnya 4 pasukan untuk menjana jadual kumpulan.', 'error');
                return;
            }

            if (!tournamentData.groupDivisionDone) {
                showToast('Pembahagian kumpulan belum selesai. Sila mulakan kira detik pembahagian kumpulan terlebih dahulu.', 'error');
                return;
            }

            // Buang semua perlawanan kumpulan sedia ada
            tournamentData.matches = tournamentData.matches.filter(m => m.type !== 'group');

            let currentMatchTime = new Date(`${startDateStr}T${startTimeStr}`);
            let matchCounter = 1;

            const groupARounds = generateGroupRoundRobin(tournamentData.teams.A.map(t => t.name));
            const groupBRounds = generateGroupRoundRobin(tournamentData.teams.B.map(t => t.name));

            // Combine rounds for scheduling
            const allRounds = [];
            for (let i = 0; i < Math.max(groupARounds.length, groupBRounds.length); i++) {
                if (groupARounds[i]) allRounds.push({ group: 'A', matches: groupARounds[i] });
                if (groupBRounds[i]) allRounds.push({ group: 'B', matches: groupBRounds[i] });
            }

            allRounds.forEach(round => {
                round.matches.forEach(matchPair => {
                    const [homeTeamName, awayTeamName] = matchPair;
                    const matchId = `${round.group}-M${matchCounter++}`;
                    tournamentData.matches.push({
                        id: matchId,
                        group: round.group,
                        type: 'group',
                        homeTeam: homeTeamName,
                        awayTeam: awayTeamName,
                        date: currentMatchTime.toISOString().slice(0, 10),
                        time: currentMatchTime.toTimeString().slice(0, 5),
                        homeScore: null,
                        awayScore: null,
                        played: false,
                        homePenalties: null,
                        awayPenalties: null,
                        homeGoals: [], awayGoals: [],
                        homeYellowCards: [], awayYellowCards: [],
                        homeRedCards: [], awayRedCards: []
                    });
                    // Advance time by 30 minutes for the next match
                    currentMatchTime.setMinutes(currentMatchTime.getMinutes() + 30);
                });
            });

            saveTournamentData(); // Save updated matches
            updateAllViews();
            showToast('Jadual perlawanan kumpulan telah dijana!', 'success');
        }


        // Knockout fixture date/time update
        document.getElementById('updateKnockoutFixtureDatesBtn').addEventListener('click', updateKnockoutFixtureDates);

        function updateKnockoutFixtureDates() {
            const knockoutStartDateStr = document.getElementById('knockout-start-date').value;
            const knockoutStartTimeStr = document.getElementById('knockout-start-time').value;

            if (!knockoutStartDateStr || !knockoutStartTimeStr) {
                showToast('Sila masukkan tarikh dan masa mula perlawanan kalah mati.', 'error');
                return;
            }

            // Update enableExtraTime setting
            tournamentData.enableExtraTime = document.getElementById('enable-extra-time').checked;

            let currentKnockoutTime = new Date(`${knockoutStartDateStr}T${knockoutStartTimeStr}`);

            tournamentData.matches.forEach(match => {
                if (match.type === 'knockout') {
                    match.date = currentKnockoutTime.toISOString().slice(0, 10);
                    match.time = currentKnockoutTime.toTimeString().slice(0, 5);
                    currentKnockoutTime.setMinutes(currentKnockoutTime.getMinutes() + 120); // 2 hours apart for knockout matches
                }
            });
            saveTournamentData(); // Save updated times
            updateAllViews();
            showToast('Tarikh dan masa perlawanan kalah mati berjaya dikemas kini!', 'success');
        }

        // Load specific knockout match details for editing
        document.getElementById('edit-knockout-match-select').addEventListener('change', loadKnockoutMatchDetailsForEdit);

        function loadKnockoutMatchDetailsForEdit() {
            const select = document.getElementById('edit-knockout-match-select');
            const matchId = select.value;
            const detailsDiv = document.getElementById('edit-knockout-match-details');
            const dateInput = document.getElementById('edit-knockout-date');
            const timeInput = document.getElementById('edit-knockout-time');

            if (matchId) {
                const match = tournamentData.matches.find(m => m.id === matchId && m.type === 'knockout');
                if (match) {
                    dateInput.value = match.date instanceof Date ? match.date.toISOString().slice(0, 10) : match.date;
                    timeInput.value = match.time;
                    detailsDiv.style.display = 'block';
                }
            } else {
                detailsDiv.style.display = 'none';
            }
        }

        // Save individual knockout match details
        document.getElementById('saveKnockoutMatchDetailsBtn').addEventListener('click', saveKnockoutMatchDetails);

        function saveKnockoutMatchDetails() {
            const select = document.getElementById('edit-knockout-match-select');
            const matchId = select.value;
            const dateInput = document.getElementById('edit-knockout-date');
            const timeInput = document.getElementById('edit-knockout-time');

            if (!matchId) {
                showToast('Sila pilih perlawanan kalah mati untuk disimpan.', 'error');
                return;
            }
            if (!dateInput.value || !timeInput.value) {
                showToast('Sila masukkan tarikh dan masa untuk perlawanan.', 'error');
                return;
            }

            const match = tournamentData.matches.find(m => m.id === matchId && m.type === 'knockout');
            if (match) {
                match.date = dateInput.value;
                match.time = timeInput.value;
                saveTournamentData();
                updateAllViews();
                populateMatchSelect(); // Update the main match select as well
                showToast('Perlawanan kalah mati berjaya dikemas kini!', 'success');
            }
        }

        // Reset Knockout Bracket
        document.getElementById('resetKnockoutBracketBtn').addEventListener('click', resetKnockoutBracket);

        function resetKnockoutBracket() {
            if (!confirm('Adakah anda pasti mahu menetapkan semula carta kalah mati? Ini akan memadamkan semua keputusan kalah mati.')) {
                return;
            }
            // Filter out knockout matches
            tournamentData.matches = tournamentData.matches.filter(m => m.type !== 'knockout');
            tournamentData.knockoutBracketGenerated = false;
            tournamentData.finalWinner = null;
            tournamentData.finalRunnerUp = null;
            tournamentData.thirdPlaceTeams = [];
            saveTournamentData(); // Save reset state
            updateAllViews();
            showToast('Carta kalah mati telah ditetapkan semula!', 'success');
        }


        // Rename Team & Logo
        document.getElementById('renameTeamBtn').addEventListener('click', renameTeam);

        async function renameTeam() {
            const teamNameSelect = document.getElementById('rename-team-select');
            const oldTeamName = teamNameSelect.value;
            const newTeamName = document.getElementById('new-team-name').value.trim();
            const newLogoFile = document.getElementById('new-team-logo-file').files[0];

            if (!oldTeamName) {
                showToast('Sila pilih pasukan untuk diubah nama.', 'error');
                return;
            }
            if (!newTeamName && !newLogoFile) {
                showToast('Sila masukkan nama pasukan baharu atau muat naik logo baharu.', 'error');
                return;
            }

            const teamToUpdate = tournamentData.allParticipatingTeams.find(t => t.name === oldTeamName);
            if (!teamToUpdate) {
                showToast('Pasukan tidak ditemui.', 'error');
                return;
            }

            // Update team name if provided
            if (newTeamName && newTeamName !== oldTeamName) {
                // Check for duplicate new team name
                if (tournamentData.allParticipatingTeams.some(t => t.name === newTeamName && t.name !== oldTeamName)) {
                    showToast('Nama pasukan ini sudah wujud.', 'error');
                    return;
                }
                // Update in allParticipatingTeams
                teamToUpdate.name = newTeamName;

                // Update in group standings
                ['A', 'B'].forEach(group => {
                    const groupTeam = tournamentData.teams[group].find(t => t.name === oldTeamName);
                    if (groupTeam) {
                        groupTeam.name = newTeamName;
                    }
                });

                // Update in matches
                tournamentData.matches.forEach(match => {
                    if (match.homeTeam === oldTeamName) match.homeTeam = newTeamName;
                    if (match.awayTeam === oldTeamName) match.awayTeam = newTeamName;

                    // Update player names in events if they belong to this team
                    match.homeGoals.forEach(g => { if (g.player.includes(oldTeamName)) g.player = g.player.replace(oldTeamName, newTeamName); });
                    match.awayGoals.forEach(g => { if (g.player.includes(oldTeamName)) g.player = g.player.replace(oldTeamName, newTeamName); });
                    match.homeYellowCards.forEach(c => { if (c.player.includes(oldTeamName)) c.player = c.player.replace(oldTeamName, newTeamName); });
                    match.awayYellowCards.forEach(c => { if (c.player.includes(oldTeamName)) c.player = c.player.replace(oldTeamName, newTeamName); });
                    match.homeRedCards.forEach(c => { if (c.player.includes(oldTeamName)) c.player = c.player.replace(oldTeamName, newTeamName); });
                    match.awayRedCards.forEach(c => { if (c.player.includes(oldTeamName)) c.player = c.player.replace(oldTeamName, newTeamName); });
                });

                // Update final results (if applicable)
                if (tournamentData.finalWinner === oldTeamName) tournamentData.finalWinner = newTeamName;
                if (tournamentData.finalRunnerUp === oldTeamName) tournamentData.finalRunnerUp = newTeamName;
                tournamentData.thirdPlaceTeams = tournamentData.thirdPlaceTeams.map(t => t === oldTeamName ? newTeamName : t);

                // Update manager credentials if associated with this team
                if (tournamentData.managerCredentials[oldTeamName]) {
                    const manager = tournamentData.managerCredentials[oldTeamName];
                    delete tournamentData.managerCredentials[oldTeamName];
                    tournamentData.managerCredentials[newTeamName] = manager;
                }
            }

            // Update logo if provided
            if (newLogoFile) {
                const reader = new FileReader();
                reader.onload = async function(e) {
                    teamToUpdate.logo = e.target.result;
                    showToast('Logo pasukan berjaya dikemas kini!', 'success');
                    await saveTournamentData(); // Save logo
                    updateAllViews();
                    populateTeamSelects();
                    // Clear file input
                    document.getElementById('new-team-logo-file').value = '';
                };
                reader.readAsDataURL(newLogoFile);
            } else {
                showToast('Nama pasukan berjaya dikemas kini!', 'success');
                await saveTournamentData(); // Save name change
                updateAllViews();
                populateTeamSelects();
            }

            document.getElementById('new-team-name').value = ''; // Clear input
        }


        // Add Team
        document.getElementById('addTeamBtn').addEventListener('click', addTeam);

        async function addTeam() {
            const teamName = document.getElementById('add-team-name').value.trim();
            const teamLogoFile = document.getElementById('add-team-logo-file').files[0];
            const managerUsername = document.getElementById('new-team-manager-username').value.trim();
            const managerPassword = document.getElementById('new-team-manager-password').value.trim();

            if (!teamName) {
                showToast('Sila masukkan nama pasukan.', 'error');
                return;
            }
            if (tournamentData.allParticipatingTeams.some(team => team.name.toLowerCase() === teamName.toLowerCase())) {
                showToast('Nama pasukan ini sudah wujud.', 'error');
                return;
            }

            let logoDataUrl = 'https://placehold.co/80x80/cccccc/000000?text=LOGO';

            if (teamLogoFile) {
                const reader = new FileReader();
                reader.onload = async function(e) {
                    logoDataUrl = e.target.result;
                    const newTeam = {
                        name: teamName,
                        logo: logoDataUrl,
                        managerUsername: managerUsername || null,
                        managerPassword: managerPassword || null, // WARNING: Store hashed passwords in real app!
                        managerName: null,
                        managerPhone: null,
                        isManagerInfoUpdated: false,
                        players: [],
                        P: 0, M: 0, S: 0, K: 0, J: 0, B: 0, diff: 0, points: 0, qualified: false
                    };
                    tournamentData.allParticipatingTeams.push(newTeam);

                    if (managerUsername && managerPassword) {
                        tournamentData.managerCredentials[teamName] = { username: managerUsername, password: managerPassword };
                    }

                    showToast(`Pasukan ${teamName} berjaya ditambahkan!`, 'success');
                    await saveTournamentData(); // Save to Firestore
                    updateAllViews();
                    // Clear inputs
                    document.getElementById('add-team-name').value = '';
                    document.getElementById('add-team-logo-file').value = '';
                    document.getElementById('new-team-manager-username').value = '';
                    document.getElementById('new-team-manager-password').value = '';
                };
                reader.readAsDataURL(teamLogoFile);
            } else {
                 const newTeam = {
                    name: teamName,
                    logo: logoDataUrl,
                    managerUsername: managerUsername || null,
                    managerPassword: managerPassword || null, // WARNING: Store hashed passwords in real app!
                    managerName: null,
                    managerPhone: null,
                    isManagerInfoUpdated: false,
                    players: [],
                    P: 0, M: 0, S: 0, K: 0, J: 0, B: 0, diff: 0, points: 0, qualified: false
                };
                tournamentData.allParticipatingTeams.push(newTeam);

                if (managerUsername && managerPassword) {
                    tournamentData.managerCredentials[teamName] = { username: managerUsername, password: managerPassword };
                }

                showToast(`Pasukan ${teamName} berjaya ditambahkan!`, 'success');
                await saveTournamentData(); // Save to Firestore
                updateAllViews();
                // Clear inputs
                document.getElementById('add-team-name').value = '';
                document.getElementById('add-team-logo-file').value = '';
                document.getElementById('new-team-manager-username').value = '';
                document.getElementById('new-team-manager-password').value = '';
            }
        }

        // Remove Team
        document.getElementById('removeTeamBtn').addEventListener('click', showRemoveTeamConfirmation);

        function showRemoveTeamConfirmation() {
            const teamNameSelect = document.getElementById('rename-team-select'); // Reusing the select for consistency
            const teamToRemove = teamNameSelect.value;

            if (!teamToRemove) {
                showToast('Sila pilih pasukan untuk dibuang.', 'error');
                return;
            }

            if (confirm(`Adakah anda pasti mahu membuang pasukan ${teamToRemove}? Ini akan memadamkan semua data yang berkaitan dengan pasukan ini.`)) {
                removeTeam(teamToRemove);
            }
        }

        async function removeTeam(teamName) {
            // Remove from allParticipatingTeams
            tournamentData.allParticipatingTeams = tournamentData.allParticipatingTeams.filter(t => t.name !== teamName);

            // Remove from groups A and B standings
            tournamentData.teams.A = tournamentData.teams.A.filter(t => t.name !== teamName);
            tournamentData.teams.B = tournamentData.teams.B.filter(t => t.name !== teamName);

            // Remove related matches (or mark them as walkovers/cancel)
            // For simplicity, we'll remove matches involving this team
            tournamentData.matches = tournamentData.matches.filter(m => m.homeTeam !== teamName && m.awayTeam !== teamName);

            // Remove from manager credentials
            delete tournamentData.managerCredentials[teamName];

            // Reset group division and knockout if affected
            tournamentData.groupDivisionDone = false;
            tournamentData.knockoutBracketGenerated = false; // This might be too aggressive, consider better logic

            showToast(`Pasukan ${teamName} berjaya dibuang!`, 'success');
            await saveTournamentData(); // Save changes
            updateAllViews();
            populateTeamSelects();
            populateMatchSelect();
        }

        // Update Individual Awards
        document.getElementById('updateIndividualAwardsBtn').addEventListener('click', updateIndividualAwards);

        async function updateIndividualAwards() {
            tournamentData.bestPlayer = document.getElementById('best-player-input').value.trim() || null;
            tournamentData.bestPlayerSchool = document.getElementById('best-player-school-input').value.trim() || null;
            tournamentData.bestGoalkeeper = document.getElementById('best-goalkeeper-input').value.trim() || null;
            tournamentData.bestGoalkeeperSchool = document.getElementById('best-goalkeeper-school-input').value.trim() || null;
            tournamentData.topScorer = document.getElementById('top-scorer-input').value.trim() || null;
            tournamentData.topScorerSchool = document.getElementById('top-scorer-school-input').value.trim() || null;

            showToast('Anugerah individu berjaya dikemas kini!', 'success');
            await saveTournamentData(); // Save awards
            updateAllViews();
        }

        // Update Header Logo
        document.getElementById('updateHeaderLogoBtn').addEventListener('click', updateHeaderLogo);

        async function updateHeaderLogo() {
            const logoFile = document.getElementById('header-logo-file').files[0];
            if (!logoFile) {
                showToast('Sila pilih fail logo untuk dimuat naik.', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = async function(e) {
                tournamentData.headerLogo = e.target.result;
                document.getElementById('header-logo').src = tournamentData.headerLogo;
                document.getElementById('nav-mobile-logo-display').src = tournamentData.headerLogo; // Update mobile logo
                showToast('Logo header berjaya dikemas kini!', 'success');
                await saveTournamentData(); // Save logo
                // Clear file input
                document.getElementById('header-logo-file').value = '';
            };
            reader.readAsDataURL(logoFile);
        }


        // =========================================================
        // MANAGER PANEL FUNCTIONS
        // =========================================================

        function updateManagerPanel() {
            const managerTeamNameDisplay = document.getElementById('manager-team-name-display');
            const managerNameInput = document.getElementById('manager-name');
            const managerPhoneInput = document.getElementById('manager-phone');
            const playersListTextarea = document.getElementById('players-list-textarea');

            if (currentUser && currentUser.role === 'manager' && currentUser.teamName) {
                const team = tournamentData.allParticipatingTeams.find(t => t.name === currentUser.teamName);
                if (team) {
                    managerTeamNameDisplay.textContent = `Pasukan Anda: ${team.name}`;
                    managerNameInput.value = team.managerName || '';
                    managerPhoneInput.value = team.managerPhone || '';
                    playersListTextarea.value = team.players.map(p => `${p.name}, ${p.jerseyNo}`).join('\n');
                } else {
                    managerTeamNameDisplay.textContent = 'Pasukan Anda: Tidak Ditemui';
                    managerNameInput.value = '';
                    managerPhoneInput.value = '';
                    playersListTextarea.value = '';
                }
            } else {
                managerTeamNameDisplay.textContent = 'Pasukan Anda: Belum Dipilih';
                managerNameInput.value = '';
                managerPhoneInput.value = '';
                playersListTextarea.value = '';
            }
        }

        // Save Team Info (Manager Panel)
        document.getElementById('saveTeamInfoBtn').addEventListener('click', saveTeamInfo);

        async function saveTeamInfo() {
            if (!currentUser || currentUser.role !== 'manager' || !currentUser.teamName) {
                showToast('Anda tidak log masuk sebagai pengurus pasukan.', 'error');
                return;
            }

            const team = tournamentData.allParticipatingTeams.find(t => t.name === currentUser.teamName);
            if (team) {
                team.managerName = document.getElementById('manager-name').value.trim();
                team.managerPhone = document.getElementById('manager-phone').value.trim();
                team.isManagerInfoUpdated = true;
                showToast('Maklumat pasukan berjaya disimpan!', 'success');
                await saveTournamentData(); // Save to Firestore
                updateAllViews();
            } else {
                showToast('Pasukan anda tidak ditemui.', 'error');
            }
        }

        // Save Players (Manager Panel)
        document.getElementById('savePlayersBtn').addEventListener('click', savePlayers);

        async function savePlayers() {
            if (!currentUser || currentUser.role !== 'manager' || !currentUser.teamName) {
                showToast('Anda tidak log masuk sebagai pengurus pasukan.', 'error');
                return;
            }

            const team = tournamentData.allParticipatingTeams.find(t => t.name === currentUser.teamName);
            if (team) {
                const playersListText = document.getElementById('players-list-textarea').value.trim();
                const players = [];
                playersListText.split('\n').forEach(line => {
                    const parts = line.split(',').map(s => s.trim());
                    if (parts.length === 2 && parts[0] && parts[1]) {
                        const jerseyNo = parseInt(parts[1]);
                        if (!isNaN(jerseyNo) && jerseyNo > 0) {
                            players.push({ name: parts[0], jerseyNo: jerseyNo });
                        } else {
                            showToast(`Nombor jersi tidak sah untuk pemain: ${parts[0]}`, 'warning');
                        }
                    } else if (parts.length > 0 && parts[0]) {
                         showToast(`Format tidak sah untuk pemain: ${parts[0]}. Sila gunakan 'Nama, Jersi'.`, 'warning');
                    }
                });
                team.players = players;
                showToast('Senarai pemain berjaya disimpan!', 'success');
                await saveTournamentData(); // Save to Firestore
                updateAllViews();
            } else {
                showToast('Pasukan anda tidak ditemui.', 'error');
            }
        }

        // =========================================================
        // LOGIN / LOGOUT FUNCTIONS
        // =========================================================

        // Handle user role selection change
        document.getElementById('user-role').addEventListener('change', function() {
            const selectedRole = this.value;
            document.getElementById('admin-login-fields').style.display = (selectedRole === 'admin') ? 'block' : 'none';
            document.getElementById('manager-login-fields').style.display = (selectedRole === 'manager') ? 'block' : 'none';
            document.getElementById('login-error').style.display = 'none'; // Clear error message
        });

        // Handle login button click
        document.getElementById('loginBtn').addEventListener('click', login);

        function login() {
            const userRole = document.getElementById('user-role').value;
            const loginError = document.getElementById('login-error');
            loginError.style.display = 'none'; // Reset error message

            if (userRole === 'admin') {
                const username = document.getElementById('admin-username').value;
                const password = document.getElementById('admin-password').value;

                if (username === tournamentData.adminCredentials.username && password === tournamentData.adminCredentials.password) {
                    currentUser = { role: 'admin', username: username };
                    showToast('Log masuk Admin berjaya!', 'success');
                    showAdminOrManagerPanel();
                } else {
                    loginError.textContent = 'Nama pengguna atau kata laluan Admin salah.';
                    loginError.style.display = 'block';
                }
            } else if (userRole === 'manager') {
                const managerTeamSelect = document.getElementById('manager-team-select');
                const selectedTeamName = managerTeamSelect.value;
                const managerUsernameInput = document.getElementById('manager-username').value;
                const managerPasswordInput = document.getElementById('manager-password').value;

                if (!selectedTeamName) {
                    loginError.textContent = 'Sila pilih pasukan anda.';
                    loginError.style.display = 'block';
                    return;
                }

                const teamManagerCreds = tournamentData.managerCredentials[selectedTeamName];
                if (teamManagerCreds && teamManagerCreds.username === managerUsernameInput && teamManagerCreds.password === managerPasswordInput) {
                    currentUser = { role: 'manager', teamName: selectedTeamName, username: managerUsernameInput };
                    showToast(`Log masuk Pengurus Pasukan ${selectedTeamName} berjaya!`, 'success');
                    showAdminOrManagerPanel();
                } else {
                    loginError.textContent = 'Nama pengguna atau kata laluan pengurus salah.';
                    loginError.style.display = 'block';
                }
            }
            updateLoggedInDisplay();
        }

        // Handle logout button click
        document.getElementById('logoutBtn').addEventListener('click', logout);

        function logout() {
            currentUser = null;
            showToast('Berjaya log keluar.', 'info');
            document.getElementById('login-section').style.display = 'block';
            document.getElementById('admin-content').style.display = 'none';
            document.getElementById('manager-content').style.display = 'none';
            updateLoggedInDisplay();
            changeTab('home'); // Redirect to home after logout
        }

        function updateLoggedInDisplay() {
            const headerUserInfo = document.getElementById('header-user-info');
            const loggedInUsernameSpan = document.getElementById('logged-in-username');
            const mobileLogoutLink = document.getElementById('mobile-logout-link');

            if (currentUser) {
                headerUserInfo.style.display = 'flex'; // Show logout button in header
                loggedInUsernameSpan.textContent = currentUser.username || currentUser.teamName;
                mobileLogoutLink.style.display = 'block';
            } else {
                headerUserInfo.style.display = 'none';
                mobileLogoutLink.style.display = 'none';
            }
        }

        function showAdminOrManagerPanel() {
            document.getElementById('login-section').style.display = 'none';
            if (currentUser.role === 'admin') {
                document.getElementById('admin-content').style.display = 'block';
                document.getElementById('manager-content').style.display = 'none';
                updateAdminPanel();
            } else if (currentUser.role === 'manager') {
                document.getElementById('admin-content').style.display = 'none';
                document.getElementById('manager-content').style.display = 'block';
                updateManagerPanel();
            }
        }


        // Function to call all update functions for views
        function updateAllViews() {
            document.getElementById('header-logo').src = tournamentData.headerLogo;
            document.getElementById('nav-mobile-logo-display').src = tournamentData.headerLogo;
            updateParticipatingTeamsList();
            updateStandings();
            updateFixtures();
            updateKnockoutBracket();
            updateFinalResults();
            populateMatchSelect(); // Re-populate after data changes
            populateTeamSelects(); // Re-populate team selects in admin/manager panels
            if (currentUser && currentUser.role === 'admin') {
                updateAdminPanel();
            } else if (currentUser && currentUser.role === 'manager') {
                updateManagerPanel();
            }
             // Ensure countdown display is updated based on current data
            if (tournamentData.countdownStartTime && !tournamentData.groupDivisionDone) {
                document.getElementById('countdown-section').style.display = 'block';
                clearInterval(countdownInterval); // Clear any existing interval
                updateCountdownDisplay(); // Call once immediately
                countdownInterval = setInterval(updateCountdownDisplay, 1000); // Update every second
            } else {
                clearInterval(countdownInterval); // Stop interval if countdown is over or not set
                document.getElementById('countdown-section').style.display = 'none';
            }
        }

        // Print functionality for tabs
        function printTab(tabId) {
            const content = document.getElementById(tabId).innerHTML;
            const originalBody = document.body.innerHTML;
            const headerHtml = document.querySelector('header').outerHTML;
            const navHtml = document.querySelector('nav').outerHTML;

            // Remove non-printable elements like admin panels from the printable content
            let printableContent = content;
            if (tabId === 'admin') {
                printableContent = `
                    <h2>Panel Admin</h2>
                    <p>Sila log masuk ke halaman web untuk menguruskan data.</p>
                `;
            } else {
                 // Remove print button itself from the content being printed
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = content;
                const printButton = tempDiv.querySelector('.print-button');
                if (printButton) {
                    printButton.remove();
                }
                printableContent = tempDiv.innerHTML;
            }

            document.body.innerHTML = `
                <style>
                    body { font-family: 'Inter', 'Poppins', sans-serif; margin: 20px; }
                    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
                    .tab-content { display: block !important; padding: 0; box-shadow: none; margin-top: 0; }
                    header, nav { display: none !important; } /* Hide header and nav during print */
                    .countdown-section, .cta-buttons, .team-info-link, .admin-login, .admin-content, .manager-content, .toast-notification, .hamburger-menu, .nav-overlay, .nav-mobile-logo-display, .header-user-info { display: none !important; }
                    .standings-table, .match-fixtures, .bracket-container, .final-result-section, .individual-awards, .team-list { width: 100%; page-break-inside: avoid; margin-bottom: 20px; }
                    table { border-collapse: collapse; width: 100%; }
                    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
                    th { background-color: #f2f2f2; }
                    .team-card, .match-card, .bracket-match, .final-winner, .award-card, .third-place-card {
                        border: 1px solid #eee;
                        box-shadow: none;
                        margin-bottom: 15px;
                        padding: 10px;
                        break-inside: avoid;
                    }
                     img { max-width: 100px; max-height: 100px; }
                    .match-events-container { flex-direction: row !important; } /* Ensure side-by-side for print if possible */
                    .match-card .home-events-column, .match-card .away-events-column {
                        width: 48% !important; /* Adjust as needed */
                        text-align: left !important;
                        flex: none !important;
                    }
                     .match-card .home-events-column .team-event-list {
                        align-items: flex-start !important;
                    }
                    /* Remove bracket lines for print */
                    .bracket-match::after, .bracket-match::before,
                    .bracket-round:first-child .bracket-match:nth-child(odd)::after,
                    .bracket-round:first-child .bracket-match:nth-child(odd)::before,
                    .bracket-round:first-child .bracket-match:nth-child(even)::after,
                    .bracket-round:first-child .bracket-match:nth-child(even)::before,
                    .bracket-round:nth-child(2) .bracket-match:first-child::before {
                        display: none !important;
                    }
                     .bracket-round { margin: 0; } /* Remove margins between rounds */
                     .qualified { background-color: #e6ffe6 !important; } /* Light green background for qualified on print */
                </style>
                <div class="container">${printableContent}</div>
            `;
            window.print();
            document.body.innerHTML = originalBody; // Restore original content after printing
            updateAllViews(); // Re-render everything to ensure correct state and listeners
            changeTab(tabId); // Re-activate the current tab
        }


        // Initialize on page load
        document.addEventListener('DOMContentLoaded', async () => {
            await loadTournamentData(); // Load data from Firestore first
            updateAllViews(); // Then update all UI elements
            changeTab('home'); // Go to home tab by default
        });

    </script>
</body>
</html>